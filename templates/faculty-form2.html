</script>
<script>
// Auto-fill Department, Portfolio Name, and Portfolio Member Name from localStorage
document.addEventListener('DOMContentLoaded', function() {
    // Robust Department fetch (query param, then localStorage)
    let deptFromQuery = new URLSearchParams(window.location.search).get('department');
    if (deptFromQuery) {
        localStorage.setItem('selectedDepartment', deptFromQuery);
    }
    let dept = deptFromQuery || localStorage.getItem('selectedDepartment') || '';
    let deptFields = document.querySelectorAll("input[name='Department'], input[name='Department:'], select[name='Department'], select[name='Department:']");
    deptFields.forEach(function(field) {
        if (dept) field.value = dept;
        field.required = true;
        // Make department mutable (not readOnly, not disabled)
        field.readOnly = false;
        field.disabled = false;
        if (field.tagName === 'SELECT') {
            field.dispatchEvent(new Event('change', { bubbles: true }));
        }
    });
    // Portfolio Name
    let portfolio = localStorage.getItem('selectedPortfolio') || new URLSearchParams(window.location.search).get('portfolio') || '';
    let portfolioFields = document.querySelectorAll("input[name='Portfolio Name'], input[name='Portfolio Name:']");
    portfolioFields.forEach(function(field) {
        field.value = portfolio;
        field.required = true;
        field.disabled = false;
    });
    // Portfolio Member Name
    let member = localStorage.getItem('selectedMemberName') || new URLSearchParams(window.location.search).get('name') || '';
    let memberFields = document.querySelectorAll("input[name='Portfolio Member Name'], input[name='Portfolio Memeber Name']");
    memberFields.forEach(function(field) {
        field.value = member;
        field.readOnly = true;
        field.required = true;
        field.disabled = false;
    });
    // On submit, forcibly set these values in the form data
    let form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            deptFields.forEach(function(field) { field.value = dept; });
            portfolioFields.forEach(function(field) { field.value = portfolio; });
            memberFields.forEach(function(field) { field.value = member; });
        });
    }
});
</script>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMC Tech Faculty - Form 2</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Prevent Double Submit Protection -->
    <script src="../static/javascript/prevent-double-submit.js"></script>
</head>

<body>
    <!-- Header -->
    <header class="bg-purple-800 text-white flex justify-between items-center px-6 py-3 shadow-md">
        <div class="flex items-center">
            <img src="https://tse1.mm.bing.net/th/id/OIP.paY-ha-IpNQJrH2Lz_JZEgHaDG?w=2560&h=1070&rs=1&pid=ImgDetMain&o=7&rm=3"
                alt="PMC Logo" class="h-12 rounded shadow-md">
        </div>
    </header>
    <div class="form-container mx-auto max-w-6xl px-4">
        <!-- Main Form -->
        <main>
            <div class="faculty-form-outer">

                <!-- Direct DB Entry: form2-weekly (now replaces header and daily section) -->
                <section style="margin: 2rem 0;">
                    <h2 class="text-2xl font-bold text-center text-purple-800 tracking-wide mb-6">2. Class Advisor Form: DAILY</h2>
                    <form id="directDbForm"
                        class="bg-white shadow-lg rounded-xl max-w-5xl mx-auto px-6 py-8 mb-10 border border-purple-200">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="flex flex-col">
                                <label for="db-dept" class="font-semibold text-gray-700 mb-1">Department:</label>
                                <select id="db-dept" name="Department:" required
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2">
                                    <option value="" disabled selected>Select Department</option>
                                    <option value="AERO">AERO</option>
                                    <option value="AIDS">AIDS</option>
                                    <option value="AIML">AIML</option>
                                    <option value="CHEM">CHEM</option>
                                    <option value="CIVIL">CIVIL</option>
                                    <option value="CSBS">CSBS</option>
                                    <option value="CSE">CSE</option>
                                    <option value="ECE">ECE</option>
                                    <option value="EEE">EEE</option>
                                    <option value="IT">IT</option>
                                    <option value="MBA">MBA</option>
                                    <option value="MCA">MCA</option>
                                    <option value="MCO">MCO</option>
                                    <option value="MECH">MECH</option>
                                    <option value="S&H V1">S&H V1</option>
                                    <option value="S&H V2">S&H V2</option>
                                    <option value="S&H V3">S&H V3</option>
                                    <option value="S&H V4">S&H V4</option>
                                    <option value="S&H V5">S&H V5</option>
                                    <option value="S&H V6">S&H V6</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label for="db-portfolio" class="font-semibold text-gray-700 mb-1">Portfolio
                                    Name:</label>
                                <input id="db-portfolio" name="Portfolio Name:" required
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="db-member" class="font-semibold text-gray-700 mb-1">Portfolio Member
                                    Name:</label>
                                <input id="db-member" name="Portfolio Member Name"
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="db-month" class="font-semibold text-gray-700 mb-1">Month:</label>
                                <select id="db-month" name="Month:" required
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2">
                                    <option value="" disabled selected>Select</option>
                                    <option value="January">January</option>
                                    <option value="February">February</option>
                                    <option value="March">March</option>
                                    <option value="April">April</option>
                                    <option value="May">May</option>
                                    <option value="June">June</option>
                                    <option value="July">July</option>
                                    <option value="August">August</option>
                                    <option value="September">September</option>
                                    <option value="October">October</option>
                                    <option value="November">November</option>
                                    <option value="December">December</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label for="db-weekno" class="font-semibold text-gray-700 mb-1">Week no:</label>
                                <input id="db-weekno" name="Week no" type="number"
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="db-weekstart" class="font-semibold text-gray-700 mb-1">Week Starting
                                    Date:</label>
                                <input id="db-weekstart" name="Week Starting Date" type="date"
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="db-weekend" class="font-semibold text-gray-700 mb-1">Week Ending
                                    Date:</label>
                                <input id="db-weekend" name="Week Ending Date" type="date"
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2" />
                            </div>
                        </div>
                        <div class="w-full border-t border-gray-200 my-6"></div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div
                                class="col-span-1 sm:col-span-2 lg:col-span-4 bg-orange-400 text-white font-bold text-lg rounded-lg px-6 py-2 mb-2 shadow flex items-center">
                                1. Action Taken report for Absentees</div>
                            <div class="flex flex-col">
                                <label for="db-status1" class="font-semibold text-gray-700 mb-1">Status_1:</label>
                                <select id="db-status1" name="Status_1"
                                    class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2">
                                    <option value="" disabled selected>Select</option>
                                    <option>Completed and Updated</option>
                                    <option>Yet to be Completed</option>
                                    <option>Under Process</option>
                                    <option>Not Applicable</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label for="db-desc1" class="font-semibold text-gray-700 mb-1">Description_1:</label>
                                <input id="db-desc1" name="Description_1"
                                    class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="db-upload1" class="font-semibold text-gray-700 mb-1">Upload the scanned
                                    file:</label>
                                <div class="flex items-center gap-2 w-full">
                                    <label
                                        class="flex items-center gap-2 cursor-pointer bg-white hover:bg-gray-100 px-3 py-2 rounded-lg border border-gray-300 transition font-medium text-gray-700">
                                        <span class="inline-flex items-center gap-1">Upload <img
                                                src="/static/img/upload.svg" alt="upload" height="20" width="24"
                                                class="inline-block align-middle" /></span>
                                        <input id="db-upload1" name="Upload the scanned file" type="file"
                                            class="ml-2 hidden" onchange="handleFileUpload(this, 'db-upload1-status', 'db-upload1-cancel')" />
                                    </label>
                                    <span id="db-upload1-status" class="hidden text-sm text-green-600 font-medium bg-green-50 px-2 py-1 rounded">
                                        ✓ Uploaded
                                    </span>
                                    <button type="button" id="db-upload1-cancel" class="hidden text-red-600 hover:text-red-800 text-sm font-medium bg-red-50 hover:bg-red-100 px-2 py-1 rounded transition" onclick="cancelFileUpload('db-upload1', 'db-upload1-status', 'db-upload1-cancel')">
                                        ✕ Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="w-full border-t border-gray-200 my-6"></div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div
                                class="col-span-1 sm:col-span-2 lg:col-span-4 bg-orange-400 text-white font-bold text-lg rounded-lg px-6 py-2 mb-2 shadow flex items-center">
                                2. Master Logbook</div>
                            <div class="flex flex-col">
                                <label for="db-status2" class="font-semibold text-gray-700 mb-1">Status_2:</label>
                                <select id="db-status2" name="Status_2"
                                    class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2">
                                    <option value="" disabled selected>Select</option>
                                    <option>Completed and Updated</option>
                                    <option>Yet to be Completed</option>
                                    <option>Under Process</option>
                                    <option>Not Applicable</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label for="db-desc2" class="font-semibold text-gray-700 mb-1">Description_2:</label>
                                <input id="db-desc2" name="Description_2" placeholder="0-200"
                                    class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="db-upload2" class="font-semibold text-gray-700 mb-1">Upload the scanned
                                    file_2:</label>
                                <div class="flex items-center gap-2 w-full">
                                    <label
                                        class="flex items-center gap-2 cursor-pointer bg-white hover:bg-gray-100 px-3 py-2 rounded-lg border border-gray-300 transition font-medium text-gray-700">
                                        <span class="inline-flex items-center gap-1">Upload <img
                                                src="/static/img/upload.svg" alt="upload" height="20" width="24"
                                                class="inline-block align-middle" /></span>
                                        <input id="db-upload2" name="Upload the scanned file_2" type="file"
                                            class="ml-2 hidden" onchange="handleFileUpload(this, 'db-upload2-status', 'db-upload2-cancel')" />
                                    </label>
                                    <span id="db-upload2-status" class="hidden text-sm text-green-600 font-medium bg-green-50 px-2 py-1 rounded">
                                        ✓ Uploaded
                                    </span>
                                    <button type="button" id="db-upload2-cancel" class="hidden text-red-600 hover:text-red-800 text-sm font-medium bg-red-50 hover:bg-red-100 px-2 py-1 rounded transition" onclick="cancelFileUpload('db-upload2', 'db-upload2-status', 'db-upload2-cancel')">
                                        ✕ Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="submit"
                            class="mt-8 bg-purple-800 hover:from-purple-400 hover:to-orange-500 text-white font-bold py-3 px-10 rounded-xl shadow-lg text-lg tracking-wide transition-all duration-200 mx-auto block">Submit</button>
                    </form>
                    <h2 class="text-2xl font-bold text-center text-purple-800 tracking-wide mb-6">2. Class Advisor Form: WEEKLY</h2>
                    <form id="weeklyDbForm"
                        class="bg-white shadow-lg rounded-xl max-w-5xl mx-auto px-6 py-8 mb-10 border border-purple-200">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="flex flex-col">
                                <label for="w-dept" class="font-semibold text-gray-700 mb-1">Department:</label>
                                <select id="w-dept" name="Department" required
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2">
                                    <option value="" disabled selected>Select</option>
                                    <option value="AERO">AERO</option>
                                    <option value="AIDS">AIDS</option>
                                    <option value="AIML">AIML</option>
                                    <option value="CHEM">CHEM</option>
                                    <option value="CIVIL">CIVIL</option>
                                    <option value="CSBS">CSBS</option>
                                    <option value="CSE">CSE</option>
                                    <option value="ECE">ECE</option>
                                    <option value="EEE">EEE</option>
                                    <option value="IT">IT</option>
                                    <option value="MCO">MCO</option>
                                                                            <option value="MECH">MECH</option>
                                        <option value="MBA">MBA</option>
                                        <option value="MCA">MCA</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label for="w-portfolio" class="font-semibold text-gray-700 mb-1">Portfolio
                                    Name:</label>
                                <input id="w-portfolio" name="Portfolio Name" required
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="w-member" class="font-semibold text-gray-700 mb-1">Portfolio Member
                                    Name:</label>
                                <input id="w-member" name="Portfolio Member Name"
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="w-month" class="font-semibold text-gray-700 mb-1">Month:</label>
                                <select id="w-month" name="Month" required
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2">
                                    <option value="" disabled selected>Select</option>
                                    <option value="January">January</option>
                                    <option value="February">February</option>
                                    <option value="March">March</option>
                                    <option value="April">April</option>
                                    <option value="May">May</option>
                                    <option value="June">June</option>
                                    <option value="July">July</option>
                                    <option value="August">August</option>
                                    <option value="September">September</option>
                                    <option value="October">October</option>
                                    <option value="November">November</option>
                                    <option value="December">December</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label for="w-weekno" class="font-semibold text-gray-700 mb-1">Week No:</label>
                                <input id="w-weekno" name="Week No" type="number"
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="w-weekstart" class="font-semibold text-gray-700 mb-1">Week Starting
                                    Date:</label>
                                <input id="w-weekstart" name="Week Starting Date" type="date"
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="w-weekend" class="font-semibold text-gray-700 mb-1">Week Ending
                                    Date:</label>
                                <input id="w-weekend" name="Week Ending Date" type="date"
                                    class="rounded-lg border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 px-3 py-2" />
                            </div>
                        </div>
                        <div class="w-full border-t border-gray-200 my-6"></div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div
                                class="col-span-1 sm:col-span-2 lg:col-span-4 bg-orange-400 text-white font-bold text-lg rounded-lg px-6 py-2 mb-2 shadow flex items-center">
                                1. Student Achievements File</div>
                            <div class="flex flex-col">
                                <label for="w-status1" class="font-semibold text-gray-700 mb-1">Status_1:</label>
                                <select id="w-status1" name="Status_1"
                                    class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2">
                                    <option value="" disabled selected>Select</option>
                                    <option>Completed and Updated</option>
                                    <option>Yet to be Completed</option>
                                    <option>Under Process</option>
                                    <option>Not Applicable</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label for="w-desc1" class="font-semibold text-gray-700 mb-1">Description_1:</label>
                                <input id="w-desc1" name="Description_1"
                                    class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="w-upload1" class="font-semibold text-gray-700 mb-1">Upload Scanned
                                    File_1:</label>
                                <div class="flex items-center gap-2 w-full">
                                    <label
                                        class="flex items-center gap-2 cursor-pointer bg-white hover:bg-gray-100 px-3 py-2 rounded-lg border border-gray-300 transition font-medium text-gray-700">
                                        <span class="inline-flex items-center gap-1">Upload <img
                                                src="/static/img/upload.svg" alt="upload" height="20" width="24"
                                                class="inline-block align-middle" /></span>
                                        <input id="w-upload1" name="Upload Scanned File_1" type="file"
                                            class="ml-2 hidden" onchange="handleFileUpload(this, 'w-upload1-status', 'w-upload1-cancel')" />
                                    </label>
                                    <span id="w-upload1-status" class="hidden text-sm text-green-600 font-medium bg-green-50 px-2 py-1 rounded">
                                        ✓ Uploaded
                                    </span>
                                    <button type="button" id="w-upload1-cancel" class="hidden text-red-600 hover:text-red-800 text-sm font-medium bg-red-50 hover:bg-red-100 px-2 py-1 rounded transition" onclick="cancelFileUpload('w-upload1', 'w-upload1-status', 'w-upload1-cancel')">
                                        ✕ Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="w-full border-t border-gray-200 my-6"></div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div
                                class="col-span-1 sm:col-span-2 lg:col-span-4 bg-orange-400 text-white font-bold text-lg rounded-lg px-6 py-2 mb-2 shadow flex items-center">
                                2. Individual Student Report</div>
                            <div class="flex flex-col">
                                <label for="w-status2" class="font-semibold text-gray-700 mb-1">Status_2:</label>
                                <select id="w-status2" name="Status_2"
                                    class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2">
                                    <option value="" disabled selected>Select</option>
                                    <option>Completed and Updated</option>
                                    <option>Yet to be Completed</option>
                                    <option>Under Process</option>
                                    <option>Not Applicable</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label for="w-desc2" class="font-semibold text-gray-700 mb-1">Description_2:</label>
                                <input id="w-desc2" name="Description_2" placeholder="0-200"
                                    class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="w-upload2" class="font-semibold text-gray-700 mb-1">Upload Scanned
                                    File_2:</label>
                                <div class="flex items-center gap-2 w-full">
                                    <label
                                        class="flex items-center gap-2 cursor-pointer bg-white hover:bg-gray-100 px-3 py-2 rounded-lg border border-gray-300 transition font-medium text-gray-700">
                                        <span class="inline-flex items-center gap-1">Upload <img
                                                src="/static/img/upload.svg" alt="upload" height="20" width="24"
                                                class="inline-block align-middle" /></span>
                                        <input id="w-upload2" name="Upload Scanned File_2" type="file"
                                            class="ml-2 hidden" onchange="handleFileUpload(this, 'w-upload2-status', 'w-upload2-cancel')" />
                                    </label>
                                    <span id="w-upload2-status" class="hidden text-sm text-green-600 font-medium bg-green-50 px-2 py-1 rounded">
                                        ✓ Uploaded
                                    </span>
                                    <button type="button" id="w-upload2-cancel" class="hidden text-red-600 hover:text-red-800 text-sm font-medium bg-red-50 hover:bg-red-100 px-2 py-1 rounded transition" onclick="cancelFileUpload('w-upload2', 'w-upload2-status', 'w-upload2-cancel')">
                                        ✕ Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="submit"
                            class="mt-8 bg-purple-800 hover:from-purple-400 hover:to-orange-500 text-white font-bold py-3 px-10 rounded-xl shadow-lg text-lg tracking-wide transition-all duration-200 mx-auto block">Submit</button>
                    </form>
        </main>
        </section>

        <!-- NEW: Direct DB Entry: form2-once in a month -->
    <h2 class="text-2xl font-bold text-center text-purple-800 tracking-wide mb-6">2. Class Advisor Form: ONCE IN A MONTH</h2>
        <form id="monthDbForm"
            class="bg-white shadow-lg rounded-xl max-w-5xl mx-auto px-6 py-8 mb-10 border border-orange-200">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="flex flex-col">
                    <label for="m-dept" class="font-semibold text-gray-700 mb-1">Department:</label>
                    <select id="m-dept" name="Department" required
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2">
                        <option value="" disabled selected>Select</option>
                        <option value="AERO">AERO</option>
                        <option value="AIDS">AIDS</option>
                        <option value="AIML">AIML</option>
                        <option value="CHEM">CHEM</option>
                        <option value="CIVIL">CIVIL</option>
                        <option value="CSBS">CSBS</option>
                        <option value="CSE">CSE</option>
                        <option value="ECE">ECE</option>
                        <option value="EEE">EEE</option>
                        <option value="IT">IT</option>
                        <option value="MCO">MCO</option>
                                                                <option value="MECH">MECH</option>
                                        <option value="MBA">MBA</option>
                                        <option value="MCA">MCA</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <label for="m-portfolio" class="font-semibold text-gray-700 mb-1">Portfolio Name:</label>
                    <input id="m-portfolio" name="Portfolio Name" required
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                </div>
                <div class="flex flex-col">
                    <label for="m-member" class="font-semibold text-gray-700 mb-1">Portfolio Member Name:</label>
                    <input id="m-member" name="Portfolio Member Name"
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                </div>
                <div class="flex flex-col">
                    <label for="m-month" class="font-semibold text-gray-700 mb-1">Month:</label>
                    <select id="m-month" name="Month" required
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2">
                        <option value="" disabled selected>Select</option>
                        <option value="January">January</option>
                        <option value="February">February</option>
                        <option value="March">March</option>
                        <option value="April">April</option>
                        <option value="May">May</option>
                        <option value="June">June</option>
                        <option value="July">July</option>
                        <option value="August">August</option>
                        <option value="September">September</option>
                        <option value="October">October</option>
                        <option value="November">November</option>
                        <option value="December">December</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <label for="m-weekno" class="font-semibold text-gray-700 mb-1">Week no:</label>
                    <input id="m-weekno" name="Week no" type="number"
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                </div>
                <div class="flex flex-col">
                    <label for="m-weekstart" class="font-semibold text-gray-700 mb-1">Week Starting Date:</label>
                    <input id="m-weekstart" name="Week Starting Date" type="date"
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                </div>
                <div class="flex flex-col">
                    <label for="m-weekend" class="font-semibold text-gray-700 mb-1">Week Ending Date:</label>
                    <input id="m-weekend" name="Week Ending Date" type="date"
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                </div>
            </div>
            <div class="w-full border-t border-gray-200 my-6"></div>
            <!-- 8 status/desc/upload rows -->
            <div id="month-status-blocks"></div>
            <button type="submit"
                class="mt-8 bg-purple-800 hover:bg-orange-700 text-white font-bold py-3 px-10 rounded-xl shadow-lg text-lg tracking-wide transition-all duration-200 mx-auto block">Submit</button>
        </form>
        <!-- NEW: Direct DB Entry: form2-weekly -->

        <!-- ONCE IN A MONTH Section -->

        <!-- ONCE IN A SEMESTER Section -->
    <h2 class="text-2xl font-bold text-center text-purple-800 tracking-wide mb-6">2. Class Advisor Form: ONCE IN A SEMESTER</h2>
        <form id="semesterDbForm"
            class="bg-white shadow-lg rounded-xl max-w-5xl mx-auto px-6 py-8 mb-10 border border-purple-200">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="flex flex-col">
                    <label for="s-dept" class="font-semibold text-gray-700 mb-1">Department:</label>
                    <select id="s-dept" name="Department" required
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2">
                        <option value="" disabled selected>Select</option>
                        <option value="AERO">AERO</option>
                        <option value="AIDS">AIDS</option>
                        <option value="AIML">AIML</option>
                        <option value="CHEM">CHEM</option>
                        <option value="CIVIL">CIVIL</option>
                        <option value="CSBS">CSBS</option>
                        <option value="CSE">CSE</option>
                        <option value="ECE">ECE</option>
                        <option value="EEE">EEE</option>
                        <option value="IT">IT</option>
                        <option value="MCO">MCO</option>
                        <option value="MECH">MECH</option>
                        <option value="MBA">MBA</option>
                        <option value="MCA">MCA</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <label for="s-portfolio" class="font-semibold text-gray-700 mb-1">Portfolio Name:</label>
                    <input id="s-portfolio" name="Portfolio Name" required
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                </div>
                <div class="flex flex-col">
                    <label for="s-member" class="font-semibold text-gray-700 mb-1">Portfolio Member Name:</label>
                    <input id="s-member" name="Portfolio Member Name"
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                </div>
                <div class="flex flex-col">
                    <label for="s-month" class="font-semibold text-gray-700 mb-1">Month:</label>
                    <select id="s-month" name="Month" required
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2">
                        <option value="" disabled selected>Select</option>
                        <option value="January">January</option>
                        <option value="February">February</option>
                        <option value="March">March</option>
                        <option value="April">April</option>
                        <option value="May">May</option>
                        <option value="June">June</option>
                        <option value="July">July</option>
                        <option value="August">August</option>
                        <option value="September">September</option>
                        <option value="October">October</option>
                        <option value="November">November</option>
                        <option value="December">December</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <label for="s-weekno" class="font-semibold text-gray-700 mb-1">Week Number:</label>
                    <input id="s-weekno" name="Week Number" type="number"
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                </div>
                <div class="flex flex-col">
                    <label for="s-weekstart" class="font-semibold text-gray-700 mb-1">Week Starting Date:</label>
                    <input id="s-weekstart" name="Week Starting Date" type="date"
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                </div>
                <div class="flex flex-col">
                    <label for="s-weekend" class="font-semibold text-gray-700 mb-1">Week Ending Date:</label>
                    <input id="s-weekend" name="Week Ending Date" type="date"
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                </div>
            </div>
            <div class="w-full border-t border-gray-200 my-6"></div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <div
                    class="col-span-1 sm:col-span-2 lg:col-span-4 bg-orange-400 text-white font-bold text-lg rounded-lg px-6 py-2 mb-2 shadow flex items-center">
                    1. Semester Report to Parents</div>
                <div class="flex flex-col">
                    <label for="s-status1" class="font-semibold text-gray-700 mb-1">Status_1:</label>
                    <select id="s-status1" name="Status_1"
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2">
                        <option value="" disabled selected>Select</option>
                        <option>Completed and Updated</option>
                        <option>Yet to be Completed</option>
                        <option>Under Process</option>
                        <option>Not Applicable</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <label for="s-desc1" class="font-semibold text-gray-700 mb-1">Description_1:</label>
                    <input id="s-desc1" name="Description_1" maxlength="200" placeholder="0-200 characters"
                        class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                </div>
                <div class="flex flex-col">
                    <label for="s-upload1" class="font-semibold text-gray-700 mb-1">Upload The Scanned File_1:</label>
                    <div class="flex items-center gap-2 w-full">
                        <label
                            class="flex items-center gap-2 cursor-pointer bg-white hover:bg-gray-100 px-3 py-2 rounded-lg border border-gray-300 transition font-medium text-gray-700">
                            <span class="inline-flex items-center gap-1">Upload <img src="/static/img/upload.svg"
                                    alt="upload" height="20" width="24" class="inline-block align-middle" /></span>
                            <input id="s-upload1" name="Upload The Scanned File_1" type="file" class="ml-2 hidden" onchange="handleFileUpload(this, 's-upload1-status', 's-upload1-cancel')" />
                        </label>
                        <span id="s-upload1-status" class="hidden text-sm text-green-600 font-medium bg-green-50 px-2 py-1 rounded">
                            ✓ Uploaded
                        </span>
                        <button type="button" id="s-upload1-cancel" class="hidden text-red-600 hover:text-red-800 text-sm font-medium bg-red-50 hover:bg-red-100 px-2 py-1 rounded transition" onclick="cancelFileUpload('s-upload1', 's-upload1-status', 's-upload1-cancel')">
                            ✕ Cancel
                        </button>
                    </div>
                </div>
            </div>
            <button type="submit"
                class="mt-8 bg-purple-800 hover:bg-orange-700 text-white font-bold py-3 px-10 rounded-xl shadow-lg text-lg tracking-wide transition-all duration-200 mx-auto block">Submit</button>
        </form>
    </div>
    </main>

</body>

<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script>
    // All logic after DOMContentLoaded and after Supabase script is loaded
    window.addEventListener('DOMContentLoaded', function () {
        // Supabase setup (after script is loaded)
        if (window.supabase) {
            const supabaseClient = window.supabase.createClient(
                "https://cbhodgwaazmjszkujrti.supabase.co",
                "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNiaG9kZ3dhYXptanN6a3VqcnRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NzY4NzEsImV4cCI6MjA3MTI1Mjg3MX0.sBRdfiWJJmZtLWsHCcNyxm1VcwkGwZWsIeeMlS49XTU"
            );
            // Helper to convert date string to yyyymmdd integer
            function dateToInt(dateStr) {
                if (!dateStr) return null;
                return parseInt(dateStr.replace(/-/g, ''));
            }
            const directDbForm = document.getElementById('directDbForm');
            if (directDbForm) {
                directDbForm.addEventListener('submit', async function (e) {
                    e.preventDefault();
                    const form = e.target;
                    
                    // Get the double-submit protection instance
                    const protection = form.doubleSubmitPrevention;
                    
                    try {
                        // Upload files to Supabase Storage and store URLs
                        async function uploadFileToStorage(file, path) {
                            if (!file) return null;
                            // Ensure bucket name matches your policy and UI
                            const bucket = 'form2-files';
                            const { data, error } = await supabaseClient.storage.from(bucket).upload(path, file, { upsert: true });
                            if (error) {
                                if (protection) protection.handleError();
                                alert('File upload failed: ' + error.message);
                                throw error;
                            }
                            // Get public URL
                            const { data: publicUrlData, error: urlError } = supabaseClient.storage.from(bucket).getPublicUrl(path);
                            if (urlError) {
                                if (protection) protection.handleError();
                                alert('Failed to get file URL: ' + urlError.message);
                                throw urlError;
                            }
                            return publicUrlData.publicUrl;
                        }

                    // Get files from form
                    const file1 = form['Upload the scanned file'].files[0];
                    const file2 = form['Upload the scanned file_2'].files[0];
                    // Generate unique file names (timestamp + original name)
                    const ts = Date.now();
                    const file1Path = file1 ? `file1/${ts}_${file1.name}` : null;
                    const file2Path = file2 ? `file2/${ts}_${file2.name}` : null;

                    let file1Url = null;
                    let file2Url = null;
                    try {
                        if (file1) file1Url = await uploadFileToStorage(file1, file1Path);
                        if (file2) file2Url = await uploadFileToStorage(file2, file2Path);
                    } catch (uploadErr) {
                        // Stop submission if upload fails
                        return;
                    }

                    // Prepare row object (do NOT include id, so it auto-increments)
                    const row = {
                        "Department:": form["Department:"].value,
                        "Portfolio Name:": form["Portfolio Name:"].value,
                        "Portfolio Member Name": form["Portfolio Member Name"].value,
                        "Month:": form["Month:"].value || null,
                        "Week no": form["Week no"].value ? parseInt(form["Week no"].value) : null,
                        "Week Starting Date": form["Week Starting Date"].value || null,
                        "Week Ending Date": form["Week Ending Date"].value || null,
                        "Status_1": form["Status_1"].value,
                        "Description_1": form["Description_1"].value,
                        "Upload the scanned file": file1Url,
                        "Status_2": form["Status_2"].value,
                        "Description_2": form["Description_2"].value,
                        "Upload the scanned file_2": file2Url
                    };
                    
                    // Debug logging to check form values
                    console.log('Daily form values:', {
                        Department: form["Department:"].value,
                        Portfolio: form["Portfolio Name:"].value,
                        Member: form["Portfolio Member Name"].value,
                        Month: form["Month:"].value,
                        WeekNo: form["Week no"].value
                    });
                    console.log('Daily row object before insert:', row);
                    
                    // Ensure month is not empty string
                    if (!row["Month:"] || row["Month:"] === "") {
                        if (protection) protection.handleError();
                        alert('Please select a month before submitting the form.');
                        return;
                    }
                    
                    // Insert into Supabase
                    const { data, error } = await supabaseClient
                        .from('Form2-daily')
                        .insert([row]);
                        
                    if (error) {
                        if (protection) protection.handleError();
                        window.location.href = 'notification.html?status=error&msg=' + encodeURIComponent(error.message);
                        console.error(error);
                    } else {
                        if (protection) protection.handleSuccess();
                        window.location.href = 'notification.html?status=success';
                        form.reset();
                    }
                    
                    } catch (error) {
                        console.error('Form submission error:', error);
                        if (protection) protection.handleError();
                        alert('An error occurred while submitting the form. Please try again.');
                    }
                });
            }
            // NEW: Weekly form logic
            const weeklyDbForm = document.getElementById('weeklyDbForm');
            if (weeklyDbForm) {
                weeklyDbForm.addEventListener('submit', async function (e) {
                    e.preventDefault();
                    const form = e.target;
                    async function uploadFileToStorage(file, path) {
                        if (!file) return null;
                        const bucket = 'form2-files';
                        const { data, error } = await supabaseClient.storage.from(bucket).upload(path, file, { upsert: true });
                        if (error) {
                            alert('File upload failed: ' + error.message);
                            throw error;
                        }
                        const { data: publicUrlData, error: urlError } = supabaseClient.storage.from(bucket).getPublicUrl(path);
                        if (urlError) {
                            alert('Failed to get file URL: ' + urlError.message);
                            throw urlError;
                        }
                        return publicUrlData.publicUrl;
                    }
                    const file1 = form['Upload Scanned File_1'].files[0];
                    const file2 = form['Upload Scanned File_2'].files[0];
                    const ts = Date.now();
                    const file1Path = file1 ? `file1/${ts}_${file1.name}` : null;
                    const file2Path = file2 ? `file2/${ts}_${file2.name}` : null;
                    let file1Url = null;
                    let file2Url = null;
                    try {
                        if (file1) file1Url = await uploadFileToStorage(file1, file1Path);
                        if (file2) file2Url = await uploadFileToStorage(file2, file2Path);
                    } catch (uploadErr) {
                        return;
                    }
                    const row = {
                        "Department": form["Department"].value,
                        "Portfolio Name": form["Portfolio Name"].value,
                        "Portfolio Member Name": form["Portfolio Member Name"].value,
                        "Month": form["Month"].value || null,
                        "Week No": form["Week No"].value ? parseInt(form["Week No"].value) : null,
                        "Week Starting Date": form["Week Starting Date"].value || null,
                        "Week Ending Date": form["Week Ending Date"].value || null,
                        "Status_1": form["Status_1"].value,
                        "Description_1": form["Description_1"].value,
                        "Upload Scanned File_1": file1Url,
                        "Status_2": form["Status_2"].value,
                        "Description_2": form["Description_2"].value,
                        "Upload Scanned File_2": file2Url
                    };
                    const { data, error } = await supabaseClient
                        .from('form2-weekly')
                        .insert([row]);
                    if (error) {
                        window.location.href = 'notification.html?status=error&msg=' + encodeURIComponent(error.message);
                        console.error(error);
                    } else {
                        window.location.href = 'notification.html?status=success';
                        form.reset();
                    }
                });
            }
            // NEW: Month form logic
            // Dynamically render 8 status/desc/upload blocks for month form
            const monthStatusBlocks = document.getElementById('month-status-blocks');
            if (monthStatusBlocks) {
                let html = '';
                const fileNames = [
                    'Master Attendence',
                    'Attendence Report To Parents',
                    'ERP Attendence Entry',
                    'Test Report to Parents',
                    'Class Committee Meeting File',
                    'Scholarship file',
                    'Project File',
                    'Student Publications File'
                ];
                for (let i = 1; i <= 8; i++) {
                    html += `
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
                            <div class="col-span-1 sm:col-span-2 lg:col-span-4 bg-orange-400 text-white font-bold text-lg rounded-lg px-6 py-2 mb-2 shadow flex items-center">${i}. ${fileNames[i - 1]}</div>
                            <div class="flex flex-col">
                                <label for="m-status${i}" class="font-semibold text-gray-700 mb-1">Status_${i}:</label>
                                <select id="m-status${i}" name="Status_${i}" class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2">
                                    <option value="" disabled selected>Select</option>
                                    <option>Completed and Updated</option>
                                    <option>Yet to be Completed</option>
                                    <option>Under Process</option>
                                    <option>Not Applicable</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label for="m-desc${i}" class="font-semibold text-gray-700 mb-1">Description_${i}:</label>
                                <input id="m-desc${i}" name="Description_${i}" class="rounded-lg border border-gray-300 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 px-3 py-2" />
                            </div>
                            <div class="flex flex-col">
                                <label for="m-upload${i}" class="font-semibold text-gray-700 mb-1">Upload The Scanned File_${i}:</label>
                                <div class="flex items-center gap-2 w-full">
                                    <label class="flex items-center gap-2 cursor-pointer bg-white hover:bg-gray-100 px-3 py-2 rounded-lg border border-gray-300 transition font-medium text-gray-700">
                                        <span class="inline-flex items-center gap-1">Upload <img src="/static/img/upload.svg" alt="upload" height="20" width="24" class="inline-block align-middle" /></span>
                                        <input id="m-upload${i}" name="Upload The Scanned File_${i}" type="file" class="ml-2 hidden" onchange="handleFileUpload(this, 'm-upload${i}-status', 'm-upload${i}-cancel')" />
                                    </label>
                                    <span id="m-upload${i}-status" class="hidden text-sm text-green-600 font-medium bg-green-50 px-2 py-1 rounded">✓ Uploaded</span>
                                    <button type="button" id="m-upload${i}-cancel" class="hidden text-red-600 hover:text-red-800 text-sm font-medium bg-red-50 hover:bg-red-100 px-2 py-1 rounded transition" onclick="cancelFileUpload('m-upload${i}', 'm-upload${i}-status', 'm-upload${i}-cancel')">✕ Cancel</button>
                                </div>
                            </div>
                        </div>
                        `;
                }
                monthStatusBlocks.innerHTML = html;
            }
            const monthDbForm = document.getElementById('monthDbForm');
            if (monthDbForm) {
                monthDbForm.addEventListener('submit', async function (e) {
                    e.preventDefault();
                    const form = e.target;
                    async function uploadFileToStorage(file, path) {
                        if (!file) return null;
                        const bucket = 'form2-files';
                        const { data, error } = await supabaseClient.storage.from(bucket).upload(path, file, { upsert: true });
                        if (error) {
                            alert('File upload failed: ' + error.message);
                            throw error;
                        }
                        const { data: publicUrlData, error: urlError } = supabaseClient.storage.from(bucket).getPublicUrl(path);
                        if (urlError) {
                            alert('Failed to get file URL: ' + urlError.message);
                            throw urlError;
                        }
                        return publicUrlData.publicUrl;
                    }
                    // Get files from form
                    const files = [];
                    for (let i = 1; i <= 8; i++) {
                        files[i] = form[`Upload The Scanned File_${i}`]?.files?.[0] || null;
                    }
                    const ts = Date.now();
                    const filePaths = files.map((file, i) => file ? `monthfile${i}_${ts}_${file.name}` : null);
                    let fileUrls = Array(9).fill(null);
                    try {
                        for (let i = 1; i <= 8; i++) {
                            if (files[i]) fileUrls[i] = await uploadFileToStorage(files[i], filePaths[i]);
                        }
                    } catch (uploadErr) {
                        return;
                    }
                    const row = {
                        "Department": form["Department"].value,
                        "Portfolio Name": form["Portfolio Name"].value,
                        "Portfolio Member Name": form["Portfolio Member Name"].value,
                        "Month": form["Month"].value || null,
                        "Week no": form["Week no"].value ? parseInt(form["Week no"].value) : null,
                        "Week Starting Date": form["Week Starting Date"].value || null,
                        "Week Ending Date": form["Week Ending Date"].value || null,
                    };
                    // Debug logging to check form values
                    console.log('Monthly form values:', {
                        Department: form["Department"].value,
                        Portfolio: form["Portfolio Name"].value,
                        Member: form["Portfolio Member Name"].value,
                        Month: form["Month"].value,
                        WeekNo: form["Week no"].value
                    });
                    console.log('Row object before insert:', row);
                    
                    // Ensure month is not empty string
                    if (!row["Month"] || row["Month"] === "") {
                        alert('Please select a month before submitting the form.');
                        return;
                    }
                    for (let i = 1; i <= 8; i++) {
                        row[`Status_${i}`] = form[`Status_${i}`]?.value || null;
                        row[`Description_${i}`] = form[`Description_${i}`]?.value || null;
                        row[`Upload The Scanned File_${i}`] = fileUrls[i] || null;
                    }
                    const { data, error } = await supabaseClient
                        .from('form2-once in a month')
                        .insert([row]);
                    if (error) {
                        window.location.href = 'notification.html?status=error&msg=' + encodeURIComponent(error.message);
                        console.error(error);
                    } else {
                        window.location.href = 'notification.html?status=success';
                        form.reset();
                    }
                });
            }
            // NEW: Semester form logic
            const semesterDbForm = document.getElementById('semesterDbForm');
            if (semesterDbForm) {
                semesterDbForm.addEventListener('submit', async function (e) {
                    e.preventDefault();
                    const form = e.target;
                    async function uploadFileToStorage(file, path) {
                        if (!file) return null;
                        const bucket = 'form2-files';
                        const { data, error } = await supabaseClient.storage.from(bucket).upload(path, file, { upsert: true });
                        if (error) {
                            alert('File upload failed: ' + error.message);
                            throw error;
                        }
                        const { data: publicUrlData, error: urlError } = supabaseClient.storage.from(bucket).getPublicUrl(path);
                        if (urlError) {
                            alert('Failed to get file URL: ' + urlError.message);
                            throw urlError;
                        }
                        return publicUrlData.publicUrl;
                    }
                    const file1 = form['Upload The Scanned File_1']?.files?.[0] || null;
                    const ts = Date.now();
                    const file1Path = file1 ? `semesterfile1_${ts}_${file1.name}` : null;
                    let file1Url = null;
                    try {
                        if (file1) file1Url = await uploadFileToStorage(file1, file1Path);
                    } catch (uploadErr) {
                        return;
                    }
                    const row = {
                        "Department": form["Department"].value,
                        "Portfolio Name": form["Portfolio Name"].value,
                        "Portfolio Member Name": form["Portfolio Member Name"].value,
                        "Month": form["Month"].value || null,
                        "Week Number": form["Week Number"].value ? parseInt(form["Week Number"].value) : null,
                        "Week Starting Date": form["Week Starting Date"].value || null,
                        "Week Ending Date": form["Week Ending Date"].value || null,
                        "Status_1": form["Status_1"]?.value || null,
                        "Description_1": form["Description_1"]?.value || null,
                        "Upload The Scanned File_1": file1Url || null
                    };
                    const { data, error } = await supabaseClient
                        .from('form2-once in a semester')
                        .insert([row]);
                    if (error) {
                        window.location.href = 'notification.html?status=error&msg=' + encodeURIComponent(error.message);
                        console.error(error);
                    } else {
                        window.location.href = 'notification.html?status=success';
                        form.reset();
                    }
                });
            }
        } else {
            console.error('Supabase script not loaded!');
        }
    });
</script>
<!-- Navigation Buttons -->
<div class="fixed bottom-6 right-6 flex gap-3 z-50">
    <button onclick="history.back()" aria-label="Back"
        class="bg-pmcPurple hover:bg-pmcPurpleDark text-white rounded-full shadow-lg p-3 flex items-center justify-center text-2xl transition">
        &#8592;
    </button>
    <button onclick="history.forward()" aria-label="Forward"
        class="bg-pmcPurple hover:bg-pmcPurpleDark text-white rounded-full shadow-lg p-3 flex items-center justify-center text-2xl transition">
        &#8594;
    </button>
</div>

<script>
// Prefill Department and Portfolio Name from localStorage for all relevant fields
window.addEventListener('DOMContentLoaded', function () {
    var dept = localStorage.getItem('selectedDept');
    var portfolio = localStorage.getItem('selectedPortfolio');
    // Daily form
    var dailyDept = document.querySelector('#directDbForm select[name="Department:"]');
    var dailyPortfolio = document.querySelector('#directDbForm input[name="Portfolio Name:"]');
    if (dept && dailyDept) {
        for (var i = 0; i < dailyDept.options.length; i++) {
            if (dailyDept.options[i].value === dept) {
                dailyDept.selectedIndex = i;
                break;
            }
        }
    }
    if (portfolio && dailyPortfolio) {
        dailyPortfolio.value = portfolio;
    }
    // Weekly form
    var weeklyDept = document.querySelector('#weeklyDbForm select[name="Department:"]');
    var weeklyPortfolio = document.querySelector('#weeklyDbForm input[name="Portfolio Name:"]');
    if (dept && weeklyDept) {
        for (var i = 0; i < weeklyDept.options.length; i++) {
            if (weeklyDept.options[i].value === dept) {
                weeklyDept.selectedIndex = i;
                break;
            }
        }
    }
    if (portfolio && weeklyPortfolio) {
        weeklyPortfolio.value = portfolio;
    }
    // Month form
    var monthDept = document.getElementById('m-dept');
    var monthPortfolio = document.getElementById('m-portfolio');
    if (dept && monthDept) {
        for (var i = 0; i < monthDept.options.length; i++) {
            if (monthDept.options[i].value === dept) {
                monthDept.selectedIndex = i;
                break;
            }
        }
    }
    if (portfolio && monthPortfolio) {
        monthPortfolio.value = portfolio;
    }
    // Semester form
    var semDept = document.getElementById('s-dept');
    var semPortfolio = document.getElementById('s-portfolio');
    if (dept && semDept) {
        for (var i = 0; i < semDept.options.length; i++) {
            if (semDept.options[i].value === dept) {
                semDept.selectedIndex = i;
                break;
            }
        }
    }
    if (portfolio && semPortfolio) {
        semPortfolio.value = portfolio;
    }
});
</script>

<script>
// File upload handling functions
function handleFileUpload(input, statusId, cancelId) {
    const file = input.files[0];
    const statusElement = document.getElementById(statusId);
    const cancelElement = document.getElementById(cancelId);
    const uploadLabel = input.closest('label');
    
    if (file) {
        // Hide the upload button
        if (uploadLabel) {
            uploadLabel.style.display = 'none';
        }
        
        // Show uploaded status and cancel button
        statusElement.classList.remove('hidden');
        cancelElement.classList.remove('hidden');
        
        // Update status text to show filename
        statusElement.innerHTML = `✓ ${file.name}`;
        
        console.log(`File uploaded: ${file.name}`);
    } else {
        // Show upload button again
        if (uploadLabel) {
            uploadLabel.style.display = 'flex';
        }
        
        // Hide status and cancel button if no file
        statusElement.classList.add('hidden');
        cancelElement.classList.add('hidden');
    }
}

function cancelFileUpload(inputName, statusId, cancelId) {
    // Find the input element by name or id
    let inputElement = document.getElementById(inputName) || document.querySelector(`input[name="${inputName}"]`);
    
    const statusElement = document.getElementById(statusId);
    const cancelElement = document.getElementById(cancelId);
    const uploadLabel = inputElement ? inputElement.closest('label') : null;
    
    if (inputElement) {
        // Clear the file input
        inputElement.value = '';
        
        // Show upload button again
        if (uploadLabel) {
            uploadLabel.style.display = 'flex';
        }
        
        // Hide status and cancel button
        if (statusElement) statusElement.classList.add('hidden');
        if (cancelElement) cancelElement.classList.add('hidden');
        
        console.log(`File upload cancelled for: ${inputName}`);
    } else {
        console.error(`Could not find input element: ${inputName}`);
    }
}

// Reset all file upload indicators when form is reset
document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('reset', function() {
            // Hide all status and cancel elements
            const statusElements = form.querySelectorAll('[id$="-status"]');
            const cancelElements = form.querySelectorAll('[id$="-cancel"]');
            const uploadLabels = form.querySelectorAll('input[type="file"]');
            
            statusElements.forEach(el => el.classList.add('hidden'));
            cancelElements.forEach(el => el.classList.add('hidden'));
            
            // Show all upload buttons again
            uploadLabels.forEach(input => {
                const uploadLabel = input.closest('label');
                if (uploadLabel) {
                    uploadLabel.style.display = 'flex';
                }
            });
        });
    });
});
</script>
<script src="/javascript/faculty-form.js"></script>  <!-- Footer -->
  <footer class="text-center py-4 mt-8">
    <p class="text-gray-400 text-sm"> © All Rights Reserved <a href="https://pmctech.org" target="_blank" class="text-gray-400 hover:text-gray-600 underline">PMC TECH</a>, IV CSE 2022-2026.<br/> 
    </p>
  </footer>


</body>

</html>