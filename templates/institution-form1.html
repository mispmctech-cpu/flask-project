<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Institution Level File Upload - Form 1</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<!-- Font Awesome for icons -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
	<!-- Prevent Double Submit Protection -->
	<script src="../static/javascript/prevent-double-submit.js"></script>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
	<style>
		th, td {
			font-size: 1rem;
		}
		input:focus, select:focus {
			outline: none;
		box-shadow: 0 0 0 2px #a78bfa33;
		border-color: #a78bfa;
	}
	.bg-orange-400 {
		background: linear-gradient(90deg, #f59e42 0%, #fbbf24 100%);
	}
	.bg-purple-800 {
		background: linear-gradient(90deg, #6d28d9 0%, #7c3aed 100%);
	}
	input[type="file"]::-webkit-file-upload-button {
		background: #ede9fe;
		color: #6d28d9;
		border: 1px solid #a78bfa;
		border-radius: 0.5rem;
		padding: 0.25rem 1rem;
		font-weight: 500;
		transition: background 0.2s;
	}
	input[type="file"]::-webkit-file-upload-button:hover {
		background: #c4b5fd;
		color: #fff;
	}
	input[type="file"]::file-selector-button {
		background: #ede9fe;
		color: #6d28d9;
		border: 1px solid #a78bfa;
		border-radius: 0.5rem;
		padding: 0.25rem 1rem;
		font-weight: 500;
		transition: background 0.2s;
	}
	input[type="file"]::file-selector-button:hover {
		background: #c4b5fd;
		color: #fff;
	}
	select {
		background: #f3f4f6;
	}
	label {
		letter-spacing: 0.01em;
	}
	.table-section-title {
		font-size: 1.1rem;
		font-weight: 700;
		letter-spacing: 0.04em;
		color: #fff;
		background: linear-gradient(90deg, #f59e42 0%, #fbbf24 100%);
		padding-left: 1rem;
	}
	@media (max-width: 900px) {
		th, td { font-size: 0.95rem; }
	}
	@media (max-width: 600px) {
		th, td { font-size: 0.9rem; }
	}
	</style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col min-h-screen">
		<div class="flex-1 flex items-center justify-center py-8 px-2">
			<div class="w-full max-w-6xl mx-auto bg-white rounded-2xl card-shadow border border-purple-300 overflow-x-auto p-0">
				<div class="bg-purple-800 py-8 px-6 text-white text-center w-full rounded-t-2xl">
					<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT2R7bHsdVlhJda1oUOZ1NPc7lvacTuGPvHgg&s" alt="" class="h-16 mb-2" style="max-height:64px; float: left;" />
					<h1 class="text-2xl md:text-4xl font-extrabold tracking-wide mb-2 drop-shadow">Director – Students Welfare & Admissions</h1>
				</div>
				<form id="instForm1" class="p-6 md:p-10 space-y-10 w-full">
			<div class="grid grid-cols-1 md:grid-cols-3 gap-8 bg-purple-50 rounded-xl p-8 card-shadow mb-8">
				<div>
					<label class="block font-semibold text-purple-900 mb-1">Portfolio Name:</label>
					<input type="text" name="Portfolio Name:" required class="w-full border-2 border-purple-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-400" />
				</div>
				<div>
					<label class="block font-semibold text-purple-900 mb-1">Portfolio Member Name:</label>
					<input type="text" name="Portfolio Member Name:" required class="w-full border-2 border-purple-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-400" />
				</div>
				<div>
					<label class="block font-semibold text-purple-900 mb-1">Month:</label>
					<select name="Month:" class="w-full border-2 border-purple-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-400">
						<option value="">Select</option>
						<option>January</option><option>February</option><option>March</option><option>April</option><option>May</option><option>June</option><option>July</option><option>August</option><option>September</option><option>October</option><option>November</option><option>December</option>
					</select>
				</div>
			</div>
			<div class="overflow-x-auto rounded-xl card-shadow border border-purple-100 bg-white w-full p-4">
				<table class="w-full min-w-[1200px] text-xs md:text-sm table-fixed">
					<colgroup>
						<col style="width: 4%">
						<col style="width: 32%">
						<col style="width: 13%">
						<col style="width: 20%">
						<col style="width: 18%">
						<col style="width: 13%">
					</colgroup>
					<thead class="bg-orange-400">
					<tr>
					<th class="border px-2 py-2 font-bold text-white">S.No</th>
					<th class="border px-2 py-2 font-bold text-white">Name of the file</th>
					<th class="border px-2 py-2 font-bold text-white">Status</th>
					<th class="border px-2 py-2 font-bold text-white">Description</th>
					<th class="border px-2 py-2 font-bold text-white">Upload the scanned file</th>
					</tr>
					</thead>
					<tbody id="inst-table-body-1">
						<!-- JS will render 21 rows here -->
					</tbody>
				</table>
			</div>
			<div class="flex justify-center mt-10">
				<button type="submit" class="bg-purple-800 hover:bg-purple-700 text-white font-bold py-3 px-12 rounded-2xl shadow-xl text-xl tracking-wide transition-all duration-200">Submit</button>
			</div>
			
					
					
		</form>
			</div>
		</div>
	<script src="https://unpkg.com/@supabase/supabase-js"></script>
	<script>
	// Autofetch using localStorage (like institution-form4.html)
	document.addEventListener('DOMContentLoaded', function() {
		var portfolio = localStorage.getItem('selectedPortfolio') || '';
		var member = localStorage.getItem('selectedMemberName') || '';
		var month = localStorage.getItem('selectedMonth') || '';
		const form = document.getElementById('instForm1');
		if (form) {
			const portfolioField = form.querySelector('input[name="Portfolio Name:"]');
			if (portfolioField && portfolio) {
				portfolioField.value = portfolio;
			}
			const memberField = form.querySelector('input[name="Portfolio Member Name:"]');
			if (memberField && member) {
				memberField.value = member;
			}
			const monthField = form.querySelector('select[name="Month:"]');
			if (monthField && month) {
				for (var i = 0; i < monthField.options.length; i++) {
					if (monthField.options[i].value === month) {
						monthField.selectedIndex = i;
						break;
					}
				}
			}
		}
	});
	// Table data from images (35 rows)
	const monthlyRows = [
		// 1. Student Support and Well-being
		'Ensure the physical, emotional, and psychological well-being of students.',
		'Facilitate access to counselling services, health care, and emergency support.',
		'Address student grievances and act as a mediator when necessary.',
		// 2. Campus Life Engagement
		'Organize and oversee extracurricular activities, including cultural, literary, and sports events.',
		'Promote student clubs, societies, and leadership initiatives.',
		'Coordinate orientation and induction programs for new students.',
		// 3. Hostel and Residential Life
		'Supervise hostel administration in collaboration with wardens.',
		'Ensure safety, hygiene, and a conducive living environment in hostels.',
		'Address issues related to mess, accommodation, and student discipline.',
		// 4. Scholarships and Financial Aid
		'Facilitate the disbursement of scholarships, fellowships, and student aid funds.',
		// 5. Student Welfare Schemes
		'Liaise with government and private agencies for student welfare schemes.',
		// 6. Discipline and Conduct
		'Work with the Principal and disciplinary committees to maintain campus discipline.',
		'Promote awareness of institutional policies and codes of conduct.',
		// 7. Liaison and Representation
		'Act as a bridge between students and administration.',
		'Represent student interests in academic and administrative councils.',
		'Coordinate with external bodies for student exchange, competitions, and outreach.',
		// 8. Special Initiatives
		'Support students from marginalized or underrepresented backgrounds.',
		'Promote inclusivity, gender sensitization, and anti-ragging measures.',
		// 9. Admissions Policy and Planning
		'Execute admission policies as per the guidelines of State Government of Tamil Nadu.',
		'Ensure adherence to reservation policies and government norms.',
		// 10. Outreach and Branding
		'Lead institutional outreach through school visits, education fairs, and digital campaigns.',
		'Collaborate with marketing teams to develop brochures, videos, and online content that highlight the college’s strengths.',
		'Build relationships with feeder institutions and career counsellors.',
		// 11. Application and Selection Process
		'Oversee the entire admissions cycle—from application receipt to final enrolment.',
		'Coordinate entrance exams, interviews, and counselling sessions.',
		'Ensure timely communication with applicants and resolution of queries.',
		// 12. Data Management and Reporting
		'Maintain accurate records of applications, admissions, and enrolment trends.',
		'Analyse data to refine recruitment strategies and forecast future intake.',
		'Prepare reports for internal review and regulatory compliance.',
		// 13. Application and Selection Process (repeat)
		'Oversee the entire admissions cycle—from application receipt to final enrolment. (Repeat)',
		'Coordinate entrance exams, interviews, and counselling sessions. (Repeat)',
		'Ensure timely communication with applicants and resolution of queries. (Repeat)',
		// 14. Data Management and Reporting (repeat)
		'Maintain accurate records of applications, admissions, and enrolment trends. (Repeat)',
		'Analyse data to refine recruitment strategies and forecast future intake. (Repeat)',
		'Prepare reports for internal review and regulatory compliance. (Repeat)'
	];
	// Render monthly rows (35 rows)
	const tbody1 = document.getElementById('inst-table-body-1');
	monthlyRows.forEach((name, i) => {
		const idx = i + 1;
		const tr = document.createElement('tr');
		tr.innerHTML = `
			<td class="border px-2 py-1 text-center">${idx}</td>
			<td class="border px-2 py-1">${name}</td>
			<td class="border px-2 py-1"><select name="Status_${idx}" class="w-full border rounded px-1 py-1"><option value="">Select</option><option>Completed</option><option>In Progress</option><option>Not Started</option><option>Not Applicable</option></select></td>
			<td class="border px-2 py-1"><input type="text" name="Description_${idx}" maxlength="200" class="w-full border rounded px-1 py-1" placeholder="0-200 chars" /></td>
			<td class="border px-2 py-1">
				<button type="button" class="upload-btn bg-purple-200 hover:bg-purple-300 text-purple-900 font-semibold px-3 py-1 rounded w-full" data-row="${idx}">Upload</button>
				<span class="file-check hidden text-green-600 font-bold ml-2" data-row="${idx}">✓</span>
				<input type="file" name="Upload the scanned file_${idx}" accept=".pdf,.jpg,.jpeg,.png" class="hidden file-input-row" data-row="${idx}" />
			</td>
		`;
		tbody1.appendChild(tr);
	});
	// Removed broken six month row rendering (no tbody2 in HTML)
	// Supabase setup (update bucket/table as needed)
	const supabase = window.supabase.createClient(
		"https://cbhodgwaazmjszkujrti.supabase.co",
		"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNiaG9kZ3dhYXptanN6a3VqcnRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NzY4NzEsImV4cCI6MjA3MTI1Mjg3MX0.sBRdfiWJJmZtLWsHCcNyxm1VcwkGwZWsIeeMlS49XTU"
	);
	async function uploadFileToStorage(file, path, bucket, uploadBtn) {
		if (!file) return null;
		const { data, error } = await supabase.storage.from(bucket).upload(path, file, { upsert: true });
		if (error) throw error;
		// Get public URL
		const { data: urlData } = supabase.storage.from(bucket).getPublicUrl(path);
		// Change the upload button to 'Uploaded' after successful upload
		if (uploadBtn) {
			const row = uploadBtn.getAttribute('data-row');
			const checkMark = document.querySelector(`.file-check[data-row="${row}"]`);
			
			uploadBtn.textContent = 'Uploaded';
			uploadBtn.className = 'bg-green-200 text-green-800 font-semibold px-3 py-1 rounded w-full';
			uploadBtn.disabled = true;
			
			// Show checkmark
			if (checkMark) {
				checkMark.classList.remove('hidden');
			}
		}
		return urlData.publicUrl;
	}
// Handle upload button click for all rows
document.addEventListener('click', function(e) {
	if (e.target && e.target.classList.contains('upload-btn')) {
		const row = e.target.getAttribute('data-row');
		const fileInput = document.querySelector(`input.file-input-row[data-row='${row}']`);
		if (fileInput) fileInput.click();
	}
});

// Handle file selection and upload for all rows (1-35)
document.addEventListener('change', async function(e) {
	if (e.target && e.target.classList.contains('file-input-row')) {
		const row = e.target.getAttribute('data-row');
		const file = e.target.files[0];
		if (!file) return;
		const uploadBtn = document.querySelector(`button.upload-btn[data-row='${row}']`);
		let bucket, path;
		if (row == '22') {
			bucket = 'Institution form1 once in six months';
			path = `sixmonthfile1_${Date.now()}_${file.name}`;
		} else {
			bucket = 'institution form1 monthly';
			path = `instfile${row}_${Date.now()}_${file.name}`;
		}
		try {
			await uploadFileToStorage(file, path, bucket, uploadBtn);
		} catch (err) {
			alert('File upload failed for row ' + row + ': ' + err.message);
		}
	}
});
			document.getElementById('instForm1').addEventListener('submit', async function(e) {
				// Save autofetch values to localStorage for next time
				try {
					var autofetchForm = e.target;
					var portfolio = autofetchForm.querySelector('input[name="Portfolio Name:"]').value || '';
					var member = autofetchForm.querySelector('input[name="Portfolio Member Name:"]').value || '';
					var month = autofetchForm.querySelector('select[name="Month:"]').value || '';
					localStorage.setItem('selectedPortfolio', portfolio);
					localStorage.setItem('selectedMemberName', member);
					localStorage.setItem('selectedMonth', month);
				} catch (err) { /* ignore */ }
		e.preventDefault();
		const form = e.target;
		const formData = new FormData(form);
		// Monthly section (1-35)
		const monthlyRow = {
			"Portfolio Name:": formData.get('Portfolio Name:'),
			"Portfolio Member Name:": formData.get('Portfolio Member Name:'),
			"Month:": formData.get('Month:'),
		};
		for (let i = 1; i <= 35; i++) {
			monthlyRow[`Status_${i}`] = formData.get(`Status_${i}`);
			monthlyRow[`Description_${i}`] = formData.get(`Description_${i}`);
			// Get the file input for this row
			const fileInput = document.querySelector(`input.file-input-row[data-row='${i}']`);
			const file = fileInput && fileInput.files[0];
			if (file && file.size > 0) {
				const ts = Date.now();
				const path = `instfile${i}_${ts}_${file.name}`;
				try {
					monthlyRow[`Upload the scanned file_${i}`] = await uploadFileToStorage(file, path, 'institution form1 monthly');
				} catch (err) {
					window.location.href = `notification.html?status=error&msg=${encodeURIComponent('File upload failed for row ' + i + ': ' + err.message)}`;
					return;
				}
			} else {
				monthlyRow[`Upload the scanned file_${i}`] = null;
			}
		}
		// Submit monthly section
		const { data: dataMonthly, error: errorMonthly } = await supabase.from('Institution-form1-monthly').insert([monthlyRow]);
		if (errorMonthly) {
			window.location.href = `notification.html?status=error&msg=${encodeURIComponent(errorMonthly.message)}`;
			return;
		}

		// Six-monthly section
		const sixMonthRow = {
			"Portfolio Name": formData.get('Portfolio Name:'),
			"Portfolio Member Name": formData.get('Portfolio Member Name'),
			"Month": formData.get('Month:'),
			"Status_1": formData.get('Status_22'),
			"Description_1": formData.get('Description_22'),
			"Upload Scanned Files_1": null
		};
		const fileInputSix = document.querySelector(`input.file-input-row[data-row='22']`);
		const fileSix = fileInputSix && fileInputSix.files[0];
		if (fileSix && fileSix.size > 0) {
			const ts = Date.now();
			const path = `sixmonthfile1_${ts}_${fileSix.name}`;
			try {
				sixMonthRow["Upload Scanned Files_1"] = await uploadFileToStorage(fileSix, path, 'Institution form1 once in six months');
			} catch (err) {
				window.location.href = `notification.html?status=error&msg=${encodeURIComponent('File upload failed for six month row: ' + err.message)}`;
				return;
			}
		}
		// Submit six-monthly section
		const { data: dataSix, error: errorSix } = await supabase.from('Institution-form1-once in six months').insert([sixMonthRow]);
		if (errorSix) {
			window.location.href = `notification.html?status=error&msg=${encodeURIComponent(errorSix.message)}`;
			return;
		}

		window.location.href = 'notification.html?status=success';
	});
	</script>  <!-- Footer -->
  <footer class="text-center py-4 mt-8">
    <p class="text-sm">
      &copy; All Rights Reserved <a href="https://pmctech.org" target="_blank" class="underline">PMC TECH</a><br>
      <p class="text-xs opacity-80 flex items-center justify-center gap-2">
                        Powered by 
                        <a href="https://zeonytechnologies.com" target="_blank" rel="noopener noreferrer" class="inline-block hover:opacity-100 transition-all duration-300 hover:scale-105">
                            <img src="../static/img/zeony logo.png" alt="Zeony Technologies" class="h-12 w-22 py-2 object-contain"/>
                        </a><p class="text-xs opacity-80">A Student driven Software!</p>
    </p>
  </footer>

</body>
</html>
