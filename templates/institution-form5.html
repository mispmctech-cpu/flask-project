</script>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<script>
// Auto-fill Portfolio Name, Portfolio Member Name, and Month from localStorage if available (like institution-form4.html)
document.addEventListener('DOMContentLoaded', function() {
	var portfolio = localStorage.getItem('selectedPortfolio') || '';
	var member = localStorage.getItem('selectedMemberName') || '';
	var month = localStorage.getItem('selectedMonth') || '';

	const form = document.getElementById('acadForm1');
	if (form) {
		const portfolioField = form.querySelector('input[name="Portfolio Name:"]');
		if (portfolioField && portfolio) {
			portfolioField.value = portfolio;
		}
		const memberField = form.querySelector('input[name="Portfolio Member Name:"]');
		if (memberField && member) {
			memberField.value = member;
		}
		const monthField = form.querySelector('select[name="Month:"]');
		if (monthField && month) {
			for (var i = 0; i < monthField.options.length; i++) {
				if (monthField.options[i].value === month) {
					monthField.selectedIndex = i;
					break;
				}
			}
		}
	}
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Table rendering (15 rows as per image and schema)
    const acadRows = [
      {scope: "Develop and implement academic policies in line with the institution's vision and autonomy framework.", target: "", tat: "15TH JUNE"},
      {scope: "Coordinate curriculum design, revision, and approval through Boards of Studies and Academic Council.", target: "", tat: "15TH JUNE & 1ST DEC"},
      {scope: "Ensure alignment with AICTE, UGC, and affiliating university norms while leveraging the flexibility of autonomy.", target: "", tat: "25TH OF MONTH"},
      {scope: "Oversee the introduction of new programs and courses based on industry trends and academic advancements.", target: "", tat: "1ST JAN"},
      {scope: "Promote interdisciplinary learning and outcome-based education (OBE).", target: "", tat: "25TH OF MONTH"},
      {scope: "Ensure timely updates to syllabi with inputs from industry and academia.", target: "", tat: "15TH NOV / 31ST MARCH"},
      {scope: "Supervise academic calendars, timetables, and course delivery across departments.", target: "", tat: "END OF DAY"},
      {scope: "Coordinate with the Controller of Examinations for smooth conduct of internal and end-semester assessments.", target: "", tat: "END OF FRIDAY"},
      {scope: "Monitor academic performance and implement corrective measures when needed.", target: "", tat: "END OF FRIDAY"},
      {scope: "Facilitate faculty orientation, and mentoring.", target: "", tat: "25TH OF MONTH"},
      {scope: "Organize faculty development programs (FDPs), workshops, and seminars on quality enhancement and UGC mandate for faculty.", target: "1 Per year", tat: "31ST DEC / 31ST MAY"},
      {scope: "Promote faculty participation in strategic planning and continuous improvement.", target: "", tat: "END OF FRIDAY"},
      {scope: "Coordinate with statutory bodies like the Academic Council and IQAC.", target: "", tat: "AS PER SCHEDULE"},
      {scope: "Ensure compliance with government and regulatory bodies for academic approvals.", target: "", tat: "25TH OF MONTH"},
      {scope: "Promote benchmarking and innovation in strategic planning and academic development.", target: "", tat: "25TH OF MONTH"},
    ];
    const tbody1 = document.getElementById('acad-table-body-1');
    if (tbody1 && tbody1.children.length === 0) {
      acadRows.forEach((row, i) => {
        const idx = i + 1;
        const tr = document.createElement('tr');
        tr.innerHTML = `
					<td class="border px-2 py-1 text-center">${idx}</td>
					<td class="border px-2 py-1">${row.scope}</td>
					<td class="border px-2 py-1 text-center">${row.target}</td>
					<td class="border px-2 py-1 text-center">${row.tat}</td>
					<td class="border px-2 py-1"><select name="Status_${idx}" class="w-full border rounded px-1 py-1">
						<option value="">Select</option>
						<option>Completed</option>
						<option>In Progress</option>
						<option>Yet to be Completed</option>
						<option>Not Applicable</option>
					</select></td>
					<td class="border px-2 py-1"><input type="text" name="Description_${idx}" maxlength="200" class="w-full border rounded px-1 py-1" placeholder="0-200 chars" /></td>
					<td class="border px-2 py-1">
            <label class="custom-upload">
              Upload
              <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5-5m0 0l5 5m-5-5v12"/></svg>
              <input type="file" name="Upload the scanned file_${idx}" accept=".pdf,.jpg,.jpeg,.png" class="file-input" data-row="${idx}" />
            </label>
            <span class="file-check hidden text-green-600 font-bold ml-2" data-row="${idx}">? Uploaded</span>
          </td>
        `;
        tbody1.appendChild(tr);
      });
    }

	// Simple file upload indicator
	document.addEventListener('change', function(e) {
		if (e.target && e.target.classList.contains('file-input')) {
			const row = e.target.getAttribute('data-row');
			const checkMark = document.querySelector(`.file-check[data-row="${row}"]`);
			if (e.target.files && e.target.files.length > 0 && checkMark) {
				checkMark.classList.remove('hidden');
			} else if (checkMark) {
				checkMark.classList.add('hidden');
			}
		}
	});

	// Supabase setup
	const supabase = window.supabase.createClient(
		"https://cbhodgwaazmjszkujrti.supabase.co",
		"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNiaG9kZ3dhYXptanN6a3VqcnRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NzY4NzEsImV4cCI6MjA3MTI1Mjg3MX0.sBRdfiWJJmZtLWsHCcNyxm1VcwkGwZWsIeeMlS49XTU"
	);
	async function uploadFileToStorage(file, path) {
		if (!file) return null;
		const { data, error } = await supabase.storage.from('Institution form5').upload(path, file, { upsert: true });
		if (error) throw error;
		const { data: urlData } = supabase.storage.from('Institution form5').getPublicUrl(path);
		return urlData.publicUrl;
	}

	const form = document.getElementById('acadForm1');
	if (form) {
		form.addEventListener('submit', async function(e) {
			e.preventDefault();
			const formData = new FormData(form);
			const member = formData.get('Portfolio Member Name:');
			const row = {
				"Portfolio Name:": formData.get('Portfolio Name:'),
				"Portfolio Member Name:": member,
				"Month:": formData.get('Month:'),
			};
			for (let i = 1; i <= 15; i++) {
				row[`Status_${i}`] = formData.get(`Status_${i}`);
				row[`Description_${i}`] = formData.get(`Description_${i}`);
				const file = formData.get(`Upload the scanned file_${i}`);
				if (file && file.size > 0) {
					const ts = Date.now();
					const path = `form5file${i}_${ts}_${file.name}`;
					try {
						row[`Upload the scanned file_${i}`] = await uploadFileToStorage(file, path);
					} catch (err) {
						window.location.href = `notification.html?status=error&msg=${encodeURIComponent('File upload failed for row ' + i + ': ' + err.message)}`;
						return;
					}
				} else if (window.draftFileUrls && window.draftFileUrls[i]) {
					row[`Upload the scanned file_${i}`] = window.draftFileUrls[i];
				} else {
					row[`Upload the scanned file_${i}`] = null;
				}
			}
			// Submit to Supabase
			const { data, error } = await supabase.from('Institution-form5').insert([row]);
			if (error) {
				window.location.href = `notification.html?status=error&msg=${encodeURIComponent(error.message)}`;
			} else {
				// Delete draft after successful submission
				if (member) {
					await supabase.from('institution_form5_drafts').delete().eq('Portfolio Member Name', member);
				}
				window.location.href = 'notification.html?status=success';
			}
		});
	}
});
</script>
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Director - Academics : Monthly</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
	<style>
	body, input, select, textarea, button {
		font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
	}
	.card-shadow {
		box-shadow: 0 4px 24px 0 rgba(80, 0, 120, 0.08), 0 1.5px 4px 0 rgba(80,0,120,0.04);
	}
	th, td {
		font-size: 1rem;
	}
	input:focus, select:focus {
		outline: none;
		box-shadow: 0 0 0 2px #a78bfa33;
		border-color: #a78bfa;
	}
	.bg-orange-400 {
		background: linear-gradient(90deg, #f59e42 0%, #fbbf24 100%);
	}
	.bg-purple-800 {
		background: linear-gradient(90deg, #6d28d9 0%, #7c3aed 100%);
	}
	.custom-upload {
		display: flex;
		align-items: center;
		justify-content: center;
		background: #ede9fe;
		color: #6d28d9;
		border: 1px solid #a78bfa;
		border-radius: 0.5rem;
		padding: 0.25rem 1rem;
		font-weight: 500;
		cursor: pointer;
		transition: background 0.2s;
	}
	.custom-upload:hover {
		background: #c4b5fd;
		color: #fff;
	}
	.custom-upload svg {
		margin-left: 0.5rem;
		width: 1.1em;
		height: 1.1em;
	}
	input[type="file"] {
		display: none;
	}
	select {
		background: #f3f4f6;
	}
	label {
		letter-spacing: 0.01em;
	}
	.table-section-title {
		font-size: 1.1rem;
		font-weight: 700;
		letter-spacing: 0.04em;
		color: #fff;
		background: linear-gradient(90deg, #f59e42 0%, #fbbf24 100%);
		padding-left: 1rem;
	}
	@media (max-width: 1200px) {
		.min-w-\[1200px\] { min-width: 900px !important; }
	}
	@media (max-width: 900px) {
		th, td { font-size: 0.95rem; }
		.min-w-\[1200px\] { min-width: 700px !important; }
		.p-8 { padding: 1.5rem !important; }
	}
	@media (max-width: 600px) {
		th, td { font-size: 0.9rem; }
		.min-w-\[1200px\] { min-width: 100vw !important; }
		.p-8 { padding: 0.5rem !important; }
		.p-6, .md\:p-10 { padding: 0.5rem !important; }
	}
	</style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col min-h-screen">
	<div class="flex-1 flex items-center justify-center py-8 px-2">
		<div class="w-full max-w-6xl mx-auto bg-white rounded-2xl card-shadow border border-purple-300 overflow-x-auto p-0">
			<div class="bg-gradient-to-r from-[#6d28d9] to-[#7c3aed] py-8 px-8 text-white text-center w-full rounded-t-2xl flex items-center justify-between" style="min-height: 90px;">
				<img src="https://www.pmctech.org/images/gallery/logo1.jpg" alt="PMC Tech Logo" class="h-16 mr-4" style="max-height:64px;" />
				<h1 class="text-2xl md:text-4xl font-extrabold tracking-wide mb-0 drop-shadow w-full text-center">DIRECTOR - ACADEMICS : MONTHLY</h1>
			</div>
			<form id="acadForm1" class="p-6 md:p-10 space-y-10 w-full">
				<div class="grid grid-cols-1 md:grid-cols-3 gap-8 bg-purple-50 rounded-xl p-8 card-shadow mb-8">
					<div>
						<label class="block font-semibold text-purple-900 mb-1">Portfolio Name:</label>
						<input type="text" name="Portfolio Name:" required class="w-full border-2 border-purple-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-400" />
					</div>
					<div>
						   <label class="block font-semibold text-purple-900 mb-1">Portfolio Member Name:</label>
						   <input type="text" name="Portfolio Member Name:" required class="w-full border-2 border-purple-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-400" />
					</div>
					<div>
						<label class="block font-semibold text-purple-900 mb-1">Month:</label>
						<select name="Month:" required class="w-full border-2 border-purple-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-purple-400">
							<option value="">-- Select Month --</option>
							<option value="January">January</option>
							<option value="February">February</option>
							<option value="March">March</option>
							<option value="April">April</option>
							<option value="May">May</option>
							<option value="June">June</option>
							<option value="July">July</option>
							<option value="August">August</option>
							<option value="September">September</option>
							<option value="October">October</option>
							<option value="November">November</option>
							<option value="December">December</option>
						</select>
					</div>
				</div>
				<div class="overflow-x-auto rounded-xl card-shadow border border-purple-100 bg-white w-full p-4">
					<table class="w-full min-w-[1200px] text-xs md:text-sm table-fixed">
						<colgroup>
							<col style="width: 4%">
							<col style="width: 32%">
							<col style="width: 13%">
							<col style="width: 13%">
							<col style="width: 13%">
							<col style="width: 13%">
							<col style="width: 12%">
						</colgroup>
						<thead class="bg-orange-400">
							<tr>
								<th class="border px-2 py-2 font-bold text-white">S.No</th>
								<th class="border px-2 py-2 font-bold text-white">Scope</th>
								<th class="border px-2 py-2 font-bold text-white">Target</th>
								<th class="border px-2 py-2 font-bold text-white">TAT</th>
								<th class="border px-2 py-2 font-bold text-white">Status</th>
								<th class="border px-2 py-2 font-bold text-white">Description</th>
								<th class="border px-2 py-2 font-bold text-white">File</th>
							</tr>
						</thead>
						<tbody id="acad-table-body-1">
							<!-- JS will render 15 rows here -->
						</tbody>
					</table>
				</div>
				<div class="flex justify-center gap-4 mt-10">
					<button type="button" id="saveDraftBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-2xl shadow-xl text-xl tracking-wide transition-all duration-200">
						<i class="fas fa-save mr-2"></i>Save as Draft
					</button>
					<button type="submit" class="bg-purple-800 hover:bg-purple-700 text-white font-bold py-3 px-12 rounded-2xl shadow-xl text-xl tracking-wide transition-all duration-200">Submit</button>
				</div>
			</form>
		</div>
	</div>
	<!-- Draft loaded banner -->
	<div id="draftBanner" class="hidden fixed top-4 right-4 bg-blue-100 border-2 border-blue-500 text-blue-800 px-6 py-3 rounded-lg shadow-lg z-50">
		<i class="fas fa-info-circle mr-2"></i>Draft loaded - Continue editing or submit when ready
	</div>
	<!-- Draft Popup Modal -->
	<div id="draftModal" class="draft-modal">
		<div class="draft-modal-content">
			<h2 class="text-2xl font-bold text-purple-900 mb-4">
				<i class="fas fa-file-alt text-blue-600 mr-2"></i>Draft Found!
			</h2>
			<p class="text-gray-700 mb-2">You have a saved draft for this form.</p>
			<p class="text-sm text-gray-600 mb-6">
				<span class="font-semibold">Saved Month:</span> <span id="draftMonthInfo" class="text-blue-600"></span>
			</p>
			<p class="text-gray-700 mb-6">Would you like to load it and continue where you left off?</p>
			<div class="flex gap-4 justify-end">
				<button id="draftDeclineBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-6 rounded-lg transition-all">
					<i class="fas fa-times mr-2"></i>Start Fresh
				</button>
				<button id="draftAcceptBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-lg transition-all">
					<i class="fas fa-check mr-2"></i>Load Draft
				</button>
			</div>
		</div>
	</div>
	<script>
	// ...existing code...

	</script>
		<!-- Footer -->
		<footer class="text-center py-4 mt-8">
    <p class="text-sm">
      &copy; All Rights Reserved <a href="https://pmctech.org" target="_blank" class="underline">PMC TECH</a><br>
      <p class="text-xs opacity-80 flex items-center justify-center gap-2">
                        Powered by 
                        <a href="https://zeonytechnologies.com" target="_blank" rel="noopener noreferrer" class="inline-block hover:opacity-100 transition-all duration-300 hover:scale-105">
                            <img src="../static/img/zeony logo.png" alt="Zeony Technologies" class="h-12 w-22 py-2 object-contain"/>
                        </a><p class="text-xs opacity-80">A Student driven Software!</p>
    </p>
	</footer>
		<!-- Supabase JS CDN (required for month-filter.js) -->
			<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
			<script src="../static/javascript/institution-draft.js"></script>
			<script>
			if (window.initInstitutionDraft && typeof initInstitutionDraft === 'function') {
				initInstitutionDraft({
					formId: 'acadForm1',
					draftTable: 'institution_form5_drafts',
					rows: 15,
					bucket: 'Institution form5',
					fileFieldPrefix: 'Upload the scanned file_',
					supabaseClient: supabase
				});
			}
			</script>
			<script src="../static/javascript/month-filter.js"></script>
    <!-- Form Access Control - checks if form is open/closed -->
    <script src="../static/javascript/form-access-control.js"></script>
</body>
</html>
