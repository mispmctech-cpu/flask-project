<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Queries Table</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-purple-50 min-h-screen flex flex-col items-center justify-center">
  <!-- Modal Popup for Resolution -->
  <div id="resolve-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md">
      <h2 class="text-lg font-bold mb-2 text-purple-800">Resolve Query</h2>
      <div class="mb-2">
        <label class="block text-sm font-semibold mb-1">Resolution Details</label>
        <textarea id="modal-resolution" class="w-full p-2 border border-gray-300 rounded" rows="3" placeholder="Enter resolution details..."></textarea>
      </div>
      <div class="mb-2">
        <label class="block text-sm font-semibold mb-1">Resolved By (Admin Name)</label>
        <input type="text" id="modal-resolvedby" class="w-full p-2 border border-gray-300 rounded" placeholder="Enter your name..." />
      </div>
      <div class="flex justify-end gap-2 mt-4">
        <button id="modal-cancel" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Cancel</button>
        <button id="modal-submit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Submit</button>
      </div>
    </div>
    <!-- Footer -->
    <footer class="bg-gray-100 text-center py-4 mt-8 border-t border-gray-300 w-full">
      <p class="text-gray-500 text-sm">
        &copy; All Rights Reserved
        <a href="https://pmctech.org" target="_blank" class="text-gray-500 hover:text-gray-700 underline">PMC TECH</a>, IV CSE 2022-2026.
      </p>
    </footer>
  </div>
  <!-- Modal Popup for Messages -->
  <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-sm text-center">
      <div id="message-modal-text" class="mb-4 text-purple-800 font-semibold"></div>
      <button id="message-modal-close" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">OK</button>
    </div>
  </div>
  <!-- Modal Popup for full Query viewing -->
  <div id="seeall-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-2xl">
      <h2 class="text-lg font-bold mb-2 text-purple-800">Full Query</h2>
      <div id="seeall-content" class="mb-4 text-gray-800 whitespace-pre-wrap"></div>
      <div class="flex justify-end">
        <button id="seeall-close" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">Close</button>
      </div>
    </div>
  </div>
  <header class="w-full max-w-4xl text-center mt-8 mb-4">
    <h1 class="text-2xl md:text-3xl font-bold text-purple-800 mb-2">FACULTY WORK ASSESSMENT PROGRESSION MANAGEMENT SYSTEM</h1>
    <h2 class="text-lg text-purple-600 font-semibold mb-4">QUERIES ADMIN VIEW</h2>
  </header>
  <div class="bg-white rounded-xl shadow-lg px-8 py-8 w-full max-w-4xl flex flex-col items-center">
    <!-- Unresolved Queries Card -->
    <div class="bg-white rounded-xl shadow-lg px-6 py-6 w-full max-w-4xl mb-8">
      <h3 class="text-xl font-semibold text-purple-700 mb-2 mt-2">Unresolved Queries</h3>
      <div class="flex flex-wrap gap-4 mb-6 w-full justify-center">
        <label class="flex flex-col items-start">
          <span class="mb-1 text-sm text-gray-600">From Date</span>
          <input type="date" id="filter-created-from" class="p-2 border border-gray-300 rounded-md w-48" />
        </label>
        <label class="flex flex-col items-start">
          <span class="mb-1 text-sm text-gray-600">To Date</span>
          <input type="date" id="filter-created-to" class="p-2 border border-gray-300 rounded-md w-48" />
        </label>
      </div>
      <!-- Text filters for unresolved queries -->
      <div class="flex flex-wrap gap-4 mb-4 w-full justify-center">
        <input type="text" id="filter-name" placeholder="Filter Name" class="p-2 border border-gray-300 rounded-md w-40" />
        <input type="text" id="filter-department" placeholder="Filter Department" class="p-2 border border-gray-300 rounded-md w-40" />
        <input type="text" id="filter-mobile" placeholder="Filter Mobile Number" class="p-2 border border-gray-300 rounded-md w-40" />
        <input type="text" id="filter-mail" placeholder="Filter Mail ID" class="p-2 border border-gray-300 rounded-md w-40" />
        <input type="text" id="filter-query" placeholder="Filter Query" class="p-2 border border-gray-300 rounded-md w-40" />
      </div>
      <div class="overflow-x-auto w-full mb-4">
        <table class="min-w-full border border-gray-300 rounded-lg text-left table-auto">
          <thead class="bg-purple-800 text-white">
            <tr>
              <th class="py-2 px-4">Name</th>
              <th class="py-2 px-4">Department</th>
              <th class="py-2 px-4">Mobile Number</th>
              <th class="py-2 px-4">Mail ID</th>
              <th class="py-2 px-4">Query</th>
              <th class="py-2 px-4">Created At</th>
              <th class="py-2 px-4">Action</th>
            </tr>
          </thead>
          <tbody id="queries-table-body" class="bg-white text-gray-700">
            <!-- Rows will be injected here -->
          </tbody>
        </table>
      </div>
      <div id="unresolved-pagination" class="flex justify-center items-center gap-2 mt-4"></div>
      <div id="no-results" class="hidden text-red-600 mt-4 font-semibold">No queries found.</div>
    </div>

    <!-- Resolved Queries Card -->
    <div class="bg-white rounded-xl shadow-lg px-6 py-6 w-full max-w-4xl">
      <h3 class="text-xl font-semibold text-green-700 mb-2 mt-2">Resolved Queries</h3>
      <div class="flex flex-wrap gap-4 mb-6 w-full justify-center">
        <label class="flex flex-col items-start">
          <span class="mb-1 text-sm text-gray-600">From Date</span>
          <input type="date" id="filter-resolved-from" class="p-2 border border-gray-300 rounded-md w-48" />
        </label>
        <label class="flex flex-col items-start">
          <span class="mb-1 text-sm text-gray-600">To Date</span>
          <input type="date" id="filter-resolved-to" class="p-2 border border-gray-300 rounded-md w-48" />
        </label>
      </div>
      <!-- Text filters for resolved queries -->
      <div class="flex flex-wrap gap-4 mb-4 w-full justify-center">
        <input type="text" id="filter-r-name" placeholder="Filter Name" class="p-2 border border-gray-300 rounded-md w-36" />
        <input type="text" id="filter-r-department" placeholder="Filter Department" class="p-2 border border-gray-300 rounded-md w-36" />
        <input type="text" id="filter-r-mobile" placeholder="Filter Mobile Number" class="p-2 border border-gray-300 rounded-md w-36" />
        <input type="text" id="filter-r-mail" placeholder="Filter Mail ID" class="p-2 border border-gray-300 rounded-md w-36" />
        <input type="text" id="filter-r-query" placeholder="Filter Query" class="p-2 border border-gray-300 rounded-md w-36" />
        <input type="text" id="filter-r-resolvedby" placeholder="Filter Resolved By" class="p-2 border border-gray-300 rounded-md w-36" />
        <input type="text" id="filter-r-resolution" placeholder="Filter Resolution" class="p-2 border border-gray-300 rounded-md w-36" />
      </div>
      <div class="overflow-x-auto w-full">
        <table class="min-w-full border border-gray-300 rounded-lg text-left table-auto">
          <thead class="bg-green-700 text-white">
            <tr>
              <th class="py-2 px-4">Name</th>
              <th class="py-2 px-4">Department</th>
              <th class="py-2 px-4">Mobile Number</th>
              <th class="py-2 px-4">Mail ID</th>
              <th class="py-2 px-4">Query</th>
              <th class="py-2 px-4">Resolved By</th>
              <th class="py-2 px-4">Resolution</th>
              <th class="py-2 px-4">Resolved At</th>
            </tr>
          </thead>
          <tbody id="resolved-table-body" class="bg-white text-gray-700">
            <!-- Rows will be injected here -->
          </tbody>
        </table>
      </div>
      <div id="resolved-pagination" class="flex justify-center items-center gap-2 mt-4"></div>
      <div id="no-resolved-results" class="hidden text-red-600 mt-4 font-semibold">No resolved queries found.</div>
    </div>
  </div>
  <script>
    const SUPABASE_URL = "https://cbhodgwaazmjszkujrti.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNiaG9kZ3dhYXptanN6a3VqcnRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NzY4NzEsImV4cCI6MjA3MTI1Mjg3MX0.sBRdfiWJJmZtLWsHCcNyxm1VcwkGwZWsIeeMlS49XTU";
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    let allQueries = [];
    let allResolved = [];
    const pageSize = 10; // rows per page
    let unresolvedCurrentPage = 1;
    let resolvedCurrentPage = 1;

    function truncateWords(text, maxWords) {
      if (!text) return '';
      const words = text.trim().split(/\s+/);
      if (words.length <= maxWords) return text;
      return words.slice(0, maxWords).join(' ') + '...';
    }

    function showFullQueryModal(text) {
      const modal = document.getElementById('seeall-modal');
      document.getElementById('seeall-content').textContent = text || '';
      modal.classList.remove('hidden');
      const closeBtn = document.getElementById('seeall-close');
      function closeHandler() { modal.classList.add('hidden'); closeBtn.removeEventListener('click', closeHandler); }
      closeBtn.addEventListener('click', closeHandler);
    }

    function goToUnresolvedPage(p) { unresolvedCurrentPage = p; renderTable(); }
    function goToResolvedPage(p) { resolvedCurrentPage = p; renderResolvedTable(); }

    async function fetchQueries() {
      const { data, error } = await supabaseClient
        .from('Queries')
        .select('*')
        .order('created_at', { ascending: false });
      if (error) {
        document.getElementById('no-results').textContent = 'Error fetching queries: ' + (error.message || 'Unknown error');
        document.getElementById('no-results').classList.remove('hidden');
        return;
      }
      allQueries = data || [];
      renderTable();
    }

    async function fetchResolved() {
      const { data, error } = await supabaseClient
        .from('ResolvedQueries')
        .select('*')
        .order('resolved_at', { ascending: false });
      if (error) {
        document.getElementById('no-resolved-results').textContent = 'Error fetching resolved queries: ' + (error.message || 'Unknown error');
        document.getElementById('no-resolved-results').classList.remove('hidden');
        return;
      }
      allResolved = data || [];
      renderResolvedTable();
    }

    function renderTable() {
      const tbody = document.getElementById('queries-table-body');
      tbody.innerHTML = '';
      const filters = {
        name: document.getElementById('filter-name').value.trim().toLowerCase(),
        department: document.getElementById('filter-department').value.trim().toLowerCase(),
        mobile: document.getElementById('filter-mobile').value.trim().toLowerCase(),
        mail: document.getElementById('filter-mail').value.trim().toLowerCase(),
        query: document.getElementById('filter-query').value.trim().toLowerCase(),
      };
      const filtered = allQueries.filter(q => {
        return (!filters.name || (q["Name"]||'').toLowerCase().includes(filters.name)) &&
               (!filters.department || (q["department"]||'').toLowerCase().includes(filters.department)) &&
               (!filters.mobile || (q["mobile number"]||'').toLowerCase().includes(filters.mobile)) &&
               (!filters.mail || (q["mail id"]||'').toLowerCase().includes(filters.mail)) &&
               (!filters.query || (q["queries"]||'').toLowerCase().includes(filters.query));
      });

      const total = filtered.length;
      const totalPages = Math.max(1, Math.ceil(total / pageSize));
      if (unresolvedCurrentPage > totalPages) unresolvedCurrentPage = totalPages;

      if (filtered.length === 0) {
        document.getElementById('no-results').classList.remove('hidden');
        document.getElementById('unresolved-pagination').innerHTML = '';
        return;
      } else {
        document.getElementById('no-results').classList.add('hidden');
        const start = (unresolvedCurrentPage - 1) * pageSize;
        const pageItems = filtered.slice(start, start + pageSize);

        pageItems.forEach(q => {
          const tr = document.createElement('tr');

          const tdName = document.createElement('td'); tdName.className = 'py-2 px-4'; tdName.textContent = q["Name"] || '';
          const tdDept = document.createElement('td'); tdDept.className = 'py-2 px-4'; tdDept.textContent = q["department"] || '';
          const tdMobile = document.createElement('td'); tdMobile.className = 'py-2 px-4'; tdMobile.textContent = q["mobile number"] || '';
          const tdMail = document.createElement('td'); tdMail.className = 'py-2 px-4'; tdMail.textContent = q["mail id"] || '';

          const tdQuery = document.createElement('td'); tdQuery.className = 'py-2 px-4';
          const fullQuery = (q["queries"] || '').toString();
          const truncated = truncateWords(fullQuery, 10);
          const span = document.createElement('span'); span.textContent = truncated;
          tdQuery.appendChild(span);
          if ((fullQuery.trim().split(/\s+/).length) > 10) {
            const btn = document.createElement('button');
            btn.className = 'text-blue-600 underline ml-2';
            btn.textContent = 'See all';
            btn.addEventListener('click', () => showFullQueryModal(fullQuery));
            tdQuery.appendChild(btn);
          }

          const tdCreated = document.createElement('td'); tdCreated.className = 'py-2 px-4'; tdCreated.textContent = q.created_at ? new Date(q.created_at).toLocaleString() : '';

          const tdAction = document.createElement('td'); tdAction.className = 'py-2 px-4';
          const resolveBtn = document.createElement('button');
          resolveBtn.className = 'resolve-btn bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded';
          resolveBtn.setAttribute('data-id', q.id);
          resolveBtn.textContent = 'Resolve';
          resolveBtn.addEventListener('click', function() {
            showResolveModal(q);
          });
          tdAction.appendChild(resolveBtn);

          tr.appendChild(tdName);
          tr.appendChild(tdDept);
          tr.appendChild(tdMobile);
          tr.appendChild(tdMail);
          tr.appendChild(tdQuery);
          tr.appendChild(tdCreated);
          tr.appendChild(tdAction);

          tbody.appendChild(tr);
        });

        renderUnresolvedPagination(totalPages);
      }
    }

    function renderUnresolvedPagination(totalPages) {
      const container = document.getElementById('unresolved-pagination');
      container.innerHTML = '';
      if (totalPages <= 1) return;
      const prev = document.createElement('button'); prev.className = 'px-3 py-1 bg-gray-200 rounded disabled:opacity-50'; prev.textContent = 'Prev'; prev.disabled = unresolvedCurrentPage === 1;
      prev.addEventListener('click', () => { if (unresolvedCurrentPage > 1) { unresolvedCurrentPage--; renderTable(); } });
      const next = document.createElement('button'); next.className = 'px-3 py-1 bg-gray-200 rounded disabled:opacity-50'; next.textContent = 'Next'; next.disabled = unresolvedCurrentPage === totalPages;
      next.addEventListener('click', () => { if (unresolvedCurrentPage < totalPages) { unresolvedCurrentPage++; renderTable(); } });
      const info = document.createElement('span'); info.className = 'px-3'; info.textContent = `Page ${unresolvedCurrentPage} of ${totalPages}`;
      container.appendChild(prev);
      container.appendChild(info);
      container.appendChild(next);
    }

    // Show resolve modal and handle submit/cancel (global function)
    function showResolveModal(queryObj) {
      const modal = document.getElementById('resolve-modal');
      modal.classList.remove('hidden');
      document.getElementById('modal-resolution').value = '';
      const savedAdmin = localStorage.getItem('adminName') || '';
      document.getElementById('modal-resolvedby').value = savedAdmin;

      const submitBtn = document.getElementById('modal-submit');
      const cancelBtn = document.getElementById('modal-cancel');

      function cleanup() {
        modal.classList.add('hidden');
        submitBtn.removeEventListener('click', submitHandler);
        cancelBtn.removeEventListener('click', cancelHandler);
      }

      function submitHandler() {
        const resolution = document.getElementById('modal-resolution').value.trim();
        const resolvedBy = document.getElementById('modal-resolvedby').value.trim();
        if (!resolution) {
          showMessageModal('Please enter resolution details.');
          return;
        }
        if (!resolvedBy) {
          showMessageModal('Please specify your name (Resolved By).');
          return;
        }
        localStorage.setItem('adminName', resolvedBy);

        supabaseClient
          .from('ResolvedQueries')
          .insert({
            "Name": queryObj["Name"],
            "department": queryObj["department"],
            "mobile number": queryObj["mobile number"],
            "mail id": queryObj["mail id"],
            "queries": queryObj["queries"],
            resolved_by: resolvedBy,
            resolution: resolution
          })
          .then(({ error: insertError }) => {
            if (insertError) {
              showMessageModal('Error resolving query: ' + (insertError.message || 'Unknown error'));
              cleanup();
              return;
            }
            supabaseClient
              .from('Queries')
              .delete()
              .eq('id', queryObj.id)
              .then(({ error: deleteError }) => {
                if (deleteError) {
                  showMessageModal('Resolved, but could not remove from Queries: ' + (deleteError.message || 'Unknown error'));
                } else {
                  showMessageModal('Query resolved and moved to ResolvedQueries.');
                  fetchQueries();
                  fetchResolved();
                }
                cleanup();
              });
          });
      }

      function cancelHandler() { cleanup(); }

      submitBtn.addEventListener('click', submitHandler);
      cancelBtn.addEventListener('click', cancelHandler);
    }

    function showMessageModal(message) {
      const modal = document.getElementById('message-modal');
      document.getElementById('message-modal-text').textContent = message;
      modal.classList.remove('hidden');
      const closeBtn = document.getElementById('message-modal-close');
      function closeHandler() { modal.classList.add('hidden'); closeBtn.removeEventListener('click', closeHandler); }
      closeBtn.addEventListener('click', closeHandler);
    }

    function renderResolvedTable() {
      const tbody = document.getElementById('resolved-table-body');
      tbody.innerHTML = '';
      const filters = {
        name: document.getElementById('filter-r-name').value.trim().toLowerCase(),
        department: document.getElementById('filter-r-department').value.trim().toLowerCase(),
        mobile: document.getElementById('filter-r-mobile').value.trim().toLowerCase(),
        mail: document.getElementById('filter-r-mail').value.trim().toLowerCase(),
        query: document.getElementById('filter-r-query').value.trim().toLowerCase(),
        resolvedby: document.getElementById('filter-r-resolvedby').value.trim().toLowerCase(),
        resolution: document.getElementById('filter-r-resolution').value.trim().toLowerCase(),
      };
      const filtered = allResolved.filter(q => {
        return (!filters.name || (q["Name"]||'').toLowerCase().includes(filters.name)) &&
               (!filters.department || (q["department"]||'').toLowerCase().includes(filters.department)) &&
               (!filters.mobile || (q["mobile number"]||'').toLowerCase().includes(filters.mobile)) &&
               (!filters.mail || (q["mail id"]||'').toLowerCase().includes(filters.mail)) &&
               (!filters.query || (q["queries"]||'').toLowerCase().includes(filters.query)) &&
               (!filters.resolvedby || (q["resolved_by"]||'').toLowerCase().includes(filters.resolvedby)) &&
               (!filters.resolution || (q["resolution"]||'').toLowerCase().includes(filters.resolution));
      });

      const total = filtered.length;
      const totalPages = Math.max(1, Math.ceil(total / pageSize));
      if (resolvedCurrentPage > totalPages) resolvedCurrentPage = totalPages;

      if (filtered.length === 0) {
        document.getElementById('no-resolved-results').classList.remove('hidden');
        document.getElementById('resolved-pagination').innerHTML = '';
        return;
      } else {
        document.getElementById('no-resolved-results').classList.add('hidden');
        const start = (resolvedCurrentPage - 1) * pageSize;
        const pageItems = filtered.slice(start, start + pageSize);

        pageItems.forEach(q => {
          const tr = document.createElement('tr');

          const tdName = document.createElement('td'); tdName.className = 'py-2 px-4'; tdName.textContent = q["Name"] || '';
          const tdDept = document.createElement('td'); tdDept.className = 'py-2 px-4'; tdDept.textContent = q["department"] || '';
          const tdMobile = document.createElement('td'); tdMobile.className = 'py-2 px-4'; tdMobile.textContent = q["mobile number"] || '';
          const tdMail = document.createElement('td'); tdMail.className = 'py-2 px-4'; tdMail.textContent = q["mail id"] || '';

          const tdQuery = document.createElement('td'); tdQuery.className = 'py-2 px-4';
          const fullQuery = (q["queries"] || '').toString();
          const truncated = truncateWords(fullQuery, 10);
          const span = document.createElement('span'); span.textContent = truncated;
          tdQuery.appendChild(span);
          if ((fullQuery.trim().split(/\s+/).length) > 10) {
            const btn = document.createElement('button');
            btn.className = 'text-blue-600 underline ml-2';
            btn.textContent = 'See all';
            btn.addEventListener('click', () => showFullQueryModal(fullQuery));
            tdQuery.appendChild(btn);
          }

          const tdResolvedBy = document.createElement('td'); tdResolvedBy.className = 'py-2 px-4'; tdResolvedBy.textContent = q["resolved_by"] || '';
          const tdResolution = document.createElement('td'); tdResolution.className = 'py-2 px-4'; tdResolution.textContent = q["resolution"] || '';
          const tdResolvedAt = document.createElement('td'); tdResolvedAt.className = 'py-2 px-4'; tdResolvedAt.textContent = q.resolved_at ? new Date(q.resolved_at).toLocaleString() : '';

          tr.appendChild(tdName);
          tr.appendChild(tdDept);
          tr.appendChild(tdMobile);
          tr.appendChild(tdMail);
          tr.appendChild(tdQuery);
          tr.appendChild(tdResolvedBy);
          tr.appendChild(tdResolution);
          tr.appendChild(tdResolvedAt);

          tbody.appendChild(tr);
        });

        renderResolvedPagination(totalPages);
      }
    }

    function renderResolvedPagination(totalPages) {
      const container = document.getElementById('resolved-pagination');
      container.innerHTML = '';
      if (totalPages <= 1) return;
      const prev = document.createElement('button'); prev.className = 'px-3 py-1 bg-gray-200 rounded disabled:opacity-50'; prev.textContent = 'Prev'; prev.disabled = resolvedCurrentPage === 1;
      prev.addEventListener('click', () => { if (resolvedCurrentPage > 1) { resolvedCurrentPage--; renderResolvedTable(); } });
      const next = document.createElement('button'); next.className = 'px-3 py-1 bg-gray-200 rounded disabled:opacity-50'; next.textContent = 'Next'; next.disabled = resolvedCurrentPage === totalPages;
      next.addEventListener('click', () => { if (resolvedCurrentPage < totalPages) { resolvedCurrentPage++; renderResolvedTable(); } });
      const info = document.createElement('span'); info.className = 'px-3'; info.textContent = `Page ${resolvedCurrentPage} of ${totalPages}`;
      container.appendChild(prev);
      container.appendChild(info);
      container.appendChild(next);
    }

    document.getElementById('filter-name').addEventListener('input', renderTable);
    document.getElementById('filter-department').addEventListener('input', renderTable);
    document.getElementById('filter-mobile').addEventListener('input', renderTable);
    document.getElementById('filter-mail').addEventListener('input', renderTable);
    document.getElementById('filter-query').addEventListener('input', renderTable);
    document.getElementById('filter-r-name').addEventListener('input', renderResolvedTable);
    document.getElementById('filter-r-department').addEventListener('input', renderResolvedTable);
    document.getElementById('filter-r-mobile').addEventListener('input', renderResolvedTable);
    document.getElementById('filter-r-mail').addEventListener('input', renderResolvedTable);
    document.getElementById('filter-r-query').addEventListener('input', renderResolvedTable);
    fetchQueries();
    fetchResolved();
  </script>
</body>
</html>
