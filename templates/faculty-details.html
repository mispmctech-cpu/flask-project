</main>
        // --- Begin: Compliance column from ap_compliance table ---
        // Fetch compliance details from ap_compliance for this faculty
        async function getAPComplianceDetails() {
          const { data: complianceRows, error } = await supabaseClient
            .from('ap_compliance')
            .select('*')
            .eq('department', data["department"])
            .eq('faculty_email', data["email"])
            .eq('faculty_name', data["Name"]);
          if (error || !complianceRows || complianceRows.length === 0) {
            return [null, 'No compliance data'];
          }
          // Use the latest row (by created_at or id)
          let row = complianceRows[0];
          if (complianceRows.length > 1) {
            row = complianceRows.reduce((a, b) => (a.created_at > b.created_at ? a : b));
          }
          return [row, null];
        }

        (async function renderDetailsTable() {
          let [apCompliance, complianceError] = await getAPComplianceDetails();
          let detailsTableHtml = "";
          if (Array.isArray(detailsTableArr) && detailsTableArr.length > 0) {
            detailsTableHtml =
              `<div class="overflow-x-auto"><table class="min-w-full text-sm border rounded-lg overflow-hidden shadow-sm bg-white">
            <thead class='bg-purple-700 text-white'>
              <tr><th class="px-4 py-2">S. NO</th><th class="px-4 py-2">PARTICULAR</th><th class="px-4 py-2">TARGET</th><th class="px-4 py-2">TAT</th><th class="px-4 py-2">Compliance</th></tr>
            </thead>
            <tbody>` +
                detailsTableArr
                  .map(
                    (row, idx) => {
                      let complianceVal = '';
                      if (apCompliance) {
                        // Map idx 0-6 to compliance_1 ... compliance_7
                        let compField = `compliance_${idx + 1}`;
                        complianceVal = apCompliance[compField] || '<span class="text-gray-400">-</span>';
                      } else if (complianceError) {
                        complianceVal = `<span class='text-gray-400'>${complianceError}</span>`;
                      } else {
                        complianceVal = '<span class="text-gray-400">-</span>';
                      }
                      return `<tr class="${idx % 2 === 0 ? "bg-gray-50" : "bg-white"}"><td class="px-2 py-2">${idx + 1}</td><td class="px-2 py-2">${row.particular || ""}</td><td class="px-2 py-2">${row.target || ""}</td><td class="px-2 py-2">${row.tat || ""}</td><td class="px-2 py-2">${complianceVal}</td></tr>`;
                    }
                  )
                  .join("") +
                `</tbody></table></div>`;
          } else {
            detailsTableHtml = '<div class="text-gray-400">No data</div>';
          }
          document.getElementById("facultyDetailsTable").innerHTML =
            detailsTableHtml;
        })();
        // --- End: Compliance column from ap_compliance table ---
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <!-- Profile + inputs (Editable Card) -->
    <section class="bg-white rounded-xl card-shadow p-6 mb-8" id="facultyCard">
      <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
        <!-- profile icon / preview -->
        <div class="flex-shrink-0 text-center">
          <input id="profileImage" type="file" accept="image/*" class="hidden" disabled />
          <div id="profilePreview" class="relative inline-block">
            <button id="profileBtn" type="button"
              class="flex items-center justify-center rounded-full bg-purple-50 border border-purple-200 profile-size overflow-hidden"
              aria-label="Select profile image" disabled>
              <!-- default SVG person-circle -->
              <svg id="defaultIcon" class="w-28 h-28 text-purple-600" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg" aria-hidden>
                <circle cx="12" cy="8" r="3.5" stroke="currentColor" stroke-width="1.4" opacity="0.95" />
                <path d="M4 20c1.5-3.6 5-6 8-6s6.5 2.4 8 6" stroke="currentColor" stroke-width="1.4"
                  stroke-linecap="round" stroke-linejoin="round" opacity="0.95" />
              </svg>
              <img id="profileImgTag" src="" alt="profile preview" class="hidden w-full h-full object-cover" />
            </button>
            <div class="text-xs text-gray-500 mt-2">Click icon to upload</div>
            <!-- Edit icon -->
            <button id="editCardBtn" type="button" class="absolute top-0 right-0 bg-white rounded-full shadow p-2 hover:bg-purple-100" title="Edit">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-purple-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 13l6-6m2 2l-6 6m-2 2h2v2h2v-2h2v-2h-2v-2h-2v2H9v2z" />
              </svg>
            </button>
          </div>
        </div>

        <!-- inline inputs -->
        <div class="flex-1 w-full">
          <div class="flex flex-col md:flex-row items-center md:items-end gap-6">
            <div class="flex-1">
              <label for="name" class="text-sm font-medium text-gray-600">Name</label>
              <input id="name" type="text" placeholder="Enter name"
                class="mt-1 block w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 focus:ring-2 focus:ring-purple-300" disabled />
            </div>
            <div class="flex-1">
              <label for="dept" class="text-sm font-medium text-gray-600">Department</label>
              <input id="dept" type="text" placeholder="Enter department"
                class="mt-1 block w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 focus:ring-2 focus:ring-purple-300" disabled />
            </div>
            <div class="flex-1">
              <label for="email" class="text-sm font-medium text-gray-600">Email ID</label>
              <input id="email" type="email" placeholder="Enter email"
                class="mt-1 block w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 focus:ring-2 focus:ring-purple-300" disabled />
            </div>
          </div>
          <div class="flex justify-end mt-4">
            <button id="saveCardBtn" type="button" class="hidden bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-2 rounded-lg shadow transition">Save</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Table -->
    <section class="card-shadow rounded-xl overflow-hidden">
      <div class="bg-white p-4">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-50">
            <tr class="text-left text-gray-700">
              <th class="p-4 w-16">S.No</th>
              <th class="p-4">Name of the form</th>
              <th class="p-4 w-60">Uploads</th>
              <th class="p-4 w-40">Status</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y">
            <!-- row 1 -->
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="p-4 align-top">1</td>
              <td class="p-4 align-top">Students Performance in Training &amp; Placement Member</td>
              <td class="p-4 align-top">
                <div class="flex items-center gap-3">
                  <button
                    class="inline-flex items-center gap-2 rounded-full bg-amber-500/90 text-white px-3 py-1.5 text-xs font-medium hover:brightness-95"
                    aria-label="View">
                    <!-- eye icon -->
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                      stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M2.458 12C3.732 7.943 7.737 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.279 7-9.542 7S3.732 16.057 2.458 12z" />
                    </svg>
                    <span>View</span>
                  </button>

                  <button
                    class="inline-flex items-center gap-2 rounded-full bg-purple-600 text-white px-3 py-1.5 text-xs font-medium hover:brightness-95"
                    aria-label="Download">
                    <!-- download icon -->
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                      stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M7 10l5 5 5-5M12 15V3" />
                    </svg>
                    <span>Download</span>
                  </button>
                </div>
              </td>
              <td class="p-4 align-top">
                <button
                  class="verify-btn inline-flex items-center justify-center rounded-full px-4 py-1.5 border border-gray-200 text-gray-600 text-sm"
                  data-verified="false">Verify</button>
              </td>
            </tr>

            <!-- row 2 -->
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="p-4 align-top">2</td>
              <td class="p-4 align-top">Class Advisor</td>
              <td class="p-4 align-top">
                <div class="flex items-center gap-3">
                  <button
                    class="inline-flex items-center gap-2 rounded-full bg-amber-500/90 text-white px-3 py-1.5 text-xs font-medium">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                      stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M2.458 12C3.732 7.943 7.737 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.279 7-9.542 7S3.732 16.057 2.458 12z" />
                    </svg>
                    <span>View</span>
                  </button>

                  <button
                    class="inline-flex items-center gap-2 rounded-full bg-purple-600 text-white px-3 py-1.5 text-xs font-medium">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                      stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M7 10l5 5 5-5M12 15V3" />
                    </svg>
                    <span>Download</span>
                  </button>
                </div>
              </td>
              <td class="p-4 align-top">
                <button
                  class="verify-btn inline-flex items-center justify-center rounded-full px-4 py-1.5 border border-gray-200 text-gray-600 text-sm"
                  data-verified="false">Verify</button>
              </td>
            </tr>

            <!-- row 3 -->
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="p-4 align-top">3</td>
              <td class="p-4 align-top">Faculty Information &amp; Contribution Member</td>
              <td class="p-4 align-top">
                <div class="flex items-center gap-3">
                  <button
                    class="inline-flex items-center gap-2 rounded-full bg-amber-500/90 text-white px-3 py-1.5 text-xs font-medium">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                      stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M2.458 12C3.732 7.943 7.737 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.279 7-9.542 7S3.732 16.057 2.458 12z" />
                    </svg>
                    <span>View</span>
                  </button>

                  <button
                    class="inline-flex items-center gap-2 rounded-full bg-purple-600 text-white px-3 py-1.5 text-xs font-medium">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                      stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M7 10l5 5 5-5M12 15V3" />
                    </svg>
                    <span>Download</span>
                  </button>
                </div>
              </td>
              <td class="p-4 align-top">
                <button
                  class="verify-btn inline-flex items-center justify-center rounded-full px-4 py-1.5 border border-gray-200 text-gray-600 text-sm"
                  data-verified="false">Verify</button>
              </td>
            </tr>

            <!-- row 4 -->
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="p-4 align-top">4</td>
              <td class="p-4 align-top">Continuous Improvement Member (Program Member)</td>
              <td class="p-4 align-top">
                <div class="flex items-center gap-3">
                  <button
                    class="inline-flex items-center gap-2 rounded-full bg-amber-500/90 text-white px-3 py-1.5 text-xs font-medium">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                      stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M2.458 12C3.732 7.943 7.737 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.279 7-9.542 7S3.732 16.057 2.458 12z" />
                    </svg>
                    <span>View</span>
                  </button>

                  <button
                    class="inline-flex items-center gap-2 rounded-full bg-purple-600 text-white px-3 py-1.5 text-xs font-medium">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                      stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M7 10l5 5 5-5M12 15V3" />
                    </svg>
                    <span>Download</span>
                  </button>
                </div>
              </td>
              <td class="p-4 align-top">
                <button
                  class="verify-btn inline-flex items-center justify-center rounded-full px-4 py-1.5 border border-gray-200 text-gray-600 text-sm"
                  data-verified="false">Verify</button>
              </td>
            </tr>

          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <script>
    // Supabase client
    const supabaseClient = window.supabase.createClient(
      "https://cbhodgwaazmjszkujrti.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNiaG9kZ3dhYXptanN6a3VqcnRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NzY4NzEsImV4cCI6MjA3MTI1Mjg3MX0.sBRdfiWJJmZtLWsHCcNyxm1VcwkGwZWsIeeMlS49XTU"
    );

    // --- Card Edit/Save Logic ---
    const editCardBtn = document.getElementById('editCardBtn');
    const saveCardBtn = document.getElementById('saveCardBtn');
    const cardInputs = [
      document.getElementById('name'),
      document.getElementById('dept'),
      document.getElementById('email')
    ];
    const profileInput = document.getElementById('profileImage');
    const profileBtn = document.getElementById('profileBtn');
    const profileImgTag = document.getElementById('profileImgTag');
    const defaultIcon = document.getElementById('defaultIcon');

    // By default, all inputs are disabled
    function setCardEditable(editable) {
      cardInputs.forEach(inp => inp.disabled = !editable);
      profileInput.disabled = !editable;
      profileBtn.disabled = !editable;
      saveCardBtn.classList.toggle('hidden', !editable);
      editCardBtn.classList.toggle('hidden', editable);
    }
    setCardEditable(false);

    editCardBtn.addEventListener('click', () => setCardEditable(true));

    // profile preview
    profileBtn.addEventListener('click', () => {
      if (!profileBtn.disabled) profileInput.click();
    });
    profileInput.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (ev) {
        profileImgTag.src = ev.target.result;
        profileImgTag.classList.remove('hidden');
        defaultIcon.classList.add('hidden');
      }
      reader.readAsDataURL(file);
    });

    // Save handler
    saveCardBtn.addEventListener('click', async function () {
      setCardEditable(false);
      // Get values
      const name = cardInputs[0].value;
      const department = cardInputs[1].value;
      const email = cardInputs[2].value;
      // Optionally handle image upload
      let imageUrl = null;
      const imageFile = profileInput.files[0];
      if (imageFile) {
        const ts = Date.now();
        try {
          const { data, error } = await supabaseClient.storage.from('Faculty').upload(`faculty_${ts}_${imageFile.name}`, imageFile, { upsert: true });
          if (error) throw error;
          const { data: publicUrlData } = supabaseClient.storage.from('Faculty').getPublicUrl(`faculty_${ts}_${imageFile.name}`);
          imageUrl = publicUrlData.publicUrl;
        } catch (e) {
          alert('Image upload failed: ' + e.message);
        }
      }
      // Find the faculty record by email (or use another unique key)
      // Update the Faculty table
      const updateObj = { Name: name, department: department };
      if (imageUrl) updateObj["Upload Image"] = imageUrl;
      const { error } = await supabaseClient
        .from('Faculty')
        .update(updateObj)
        .eq('email', email);
      if (error) {
        alert('Update failed: ' + error.message);
      } else {
        alert('Faculty details updated!');
      }
    });

    // verify toggle (unchanged)
    document.querySelectorAll('.verify-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const verified = this.getAttribute('data-verified') === 'true';
        if (!verified) {
          this.setAttribute('data-verified', 'true');
          this.classList.remove('border-gray-200');
          this.classList.remove('text-gray-600');
          this.classList.add('bg-green-500', 'text-white', 'border-green-600');
          this.textContent = 'Verified';
        } else {
          this.setAttribute('data-verified', 'false');
          this.classList.remove('bg-green-500', 'text-white', 'border-green-600');
          this.classList.add('border-gray-200', 'text-gray-600');
          this.textContent = 'Verify';
        }
      });
    });
  </script>  <!-- Footer -->
  <footer class="text-center py-4 mt-8">
    <p class="text-gray-400 text-sm"> 2025 <a href="https://zeonytechnologies.netlify.app" target="_blank" class="text-gray-400 hover:text-gray-600 underline">Zeony Technologies</a>. All Rights Reserved
    </p>
  </footer>

</body>

</html>