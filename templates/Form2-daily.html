<!-- Form2-daily.html: Direct entry for new Form2-daily table (Class Advisor Daily, new structure) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Advisor (Daily) - New Table</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-2xl mx-auto mt-10 bg-white p-8 rounded shadow">
        <h1 class="text-2xl font-bold text-purple-800 mb-6">Class Advisor (Daily) - New Table</h1>
        <form id="form2DailyNew" class="space-y-4">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block font-semibold mb-1">Department:</label>
                    <input name="Department:" required class="w-full border rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Portfolio Name:</label>
                    <input name="Portfolio Name:" required class="w-full border rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Portfolio Member Name:</label>
                    <input name="Portfolio Member Name" required class="w-full border rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Month:</label>
                    <input name="Month:" required class="w-full border rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Week no:</label>
                    <input name="Week no" type="number" required class="w-full border rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Week Starting Date:</label>
                    <input name="Week Starting Date" type="date" class="w-full border rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Week Ending Date:</label>
                    <input name="Week Ending Date" type="date" class="w-full border rounded px-3 py-2" />
                </div>
            </div>
            <div class="border-t my-4"></div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block font-semibold mb-1">Status 1:</label>
                    <input name="Status_1" class="w-full border rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Description 1:</label>
                    <input name="Description_1" class="w-full border rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Upload the scanned file:</label>
                    <input name="Upload the scanned file" type="file" class="w-full" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Status 2:</label>
                    <input name="Status_2" class="w-full border rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Description 2:</label>
                    <input name="Description_2" class="w-full border rounded px-3 py-2" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Upload the scanned file 2:</label>
                    <input name="Upload the scanned file_2" type="file" class="w-full" />
                </div>
            </div>
            <button type="submit" class="mt-6 bg-purple-800 text-white px-6 py-2 rounded hover:bg-purple-900">Submit</button>
        </form>
        <div id="form2DailyNewMsg" class="mt-4 text-center"></div>
    </div>
    <script>
    const supabase = window.supabase.createClient(
        "https://cbhodgwaazmjszkujrti.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNiaG9kZ3dhYXptanN6a3VqcnRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NzY4NzEsImV4cCI6MjA3MTI1Mjg3MX0.sBRdfiWJJmZtLWsHCcNyxm1VcwkGwZWsIeeMlS49XTU"
    );
    async function uploadFileToStorage(file, path) {
        if (!file) return null;
        const { data, error } = await supabase.storage.from('faculty-workdone').upload(path, file, { upsert: true });
        if (error) throw error;
        const { publicUrl } = supabase.storage.from('faculty-workdone').getPublicUrl(path).data;
        return publicUrl;
    }
    document.getElementById('form2DailyNew').addEventListener('submit', async function(e) {
        e.preventDefault();
        const form = e.target;
        const file1 = form['Upload the scanned file'].files[0];
        const file2 = form['Upload the scanned file_2'].files[0];
        const ts = Date.now();
        let file1Url = null, file2Url = null;
        try {
            if (file1) file1Url = await uploadFileToStorage(file1, `file1/${ts}_${file1.name}`);
            if (file2) file2Url = await uploadFileToStorage(file2, `file2/${ts}_${file2.name}`);
        } catch (err) {
            document.getElementById('form2DailyNewMsg').textContent = 'File upload failed: ' + err.message;
            return;
        }
        const row = {
            "Department:": form["Department:"].value,
            "Portfolio Name:": form["Portfolio Name:"].value,
            "Portfolio Member Name": form["Portfolio Member Name"].value,
            "Month:": form["Month:"].value,
            "Week no": form["Week no"].value ? parseInt(form["Week no"].value) : null,
            "Week Starting Date": form["Week Starting Date"].value,
            "Week Ending Date": form["Week Ending Date"].value,
            "Status_1": form["Status_1"].value,
            "Description_1": form["Description_1"].value,
            "Upload the scanned file": file1Url,
            "Status_2": form["Status_2"].value,
            "Description_2": form["Description_2"].value,
            "Upload the scanned file_2": file2Url
        };
        const { data, error } = await supabase.from('Form2-daily').insert([row]);
        if (error) {
            document.getElementById('form2DailyNewMsg').textContent = 'Submission failed: ' + error.message;
        } else {
            document.getElementById('form2DailyNewMsg').textContent = 'Submitted successfully!';
            form.reset();
        }
    });
    </script>
</body>
</html>
