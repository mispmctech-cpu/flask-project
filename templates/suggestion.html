<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Suggestion Form</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-purple-50 min-h-screen flex flex-col items-center justify-center">
  <header class="w-full max-w-2xl text-center mt-8 mb-4">
    <h1 class="text-2xl md:text-3xl font-bold text-purple-800 mb-2">FACULTY WORK ASSESSMENT PROGRESSION MANAGEMENT SYSTEM</h1>
    <h2 class="text-lg text-purple-600 font-semibold mb-4">SUGGESTION FORM</h2>
  </header>
  <div class="bg-white rounded-xl shadow-lg px-8 py-8 w-full max-w-md flex flex-col items-center">
    <form id="suggestion-form" class="flex flex-col gap-4 w-full">
      <input type="text" id="name" placeholder="Name (Optional)" class="p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-800" />
      <input type="text" id="department" placeholder="Department (Optional)" class="p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-800" />
      <div class="relative">
        <textarea id="suggestions" placeholder="Your Suggestions (Maximum 500
         words)" required maxlength="2500" class="p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-800 w-full h-32 resize-none"></textarea>
        <div id="word-count" class="text-sm text-gray-500 mt-1 text-right">0/500 words</div>
      </div>
      <button type="submit" class="bg-purple-800 hover:bg-green-500 text-white font-semibold py-3 rounded-lg transition-colors duration-200 shadow">Submit Suggestion</button>
    </form>
    <div id="success-message" class="hidden text-green-600 mt-4 font-semibold">Suggestion submitted successfully!</div>
    <div id="error-message" class="hidden text-red-600 mt-4 font-semibold"></div>
  </div>
  <footer class="text-center py-4 mt-8">
    <p class="text-sm">
      &copy; All Rights Reserved <a href="https://pmctech.org" target="_blank" class="underline">PMC TECH</a><br>
      <p class="text-xs opacity-80 flex items-center justify-center gap-2">
                        Powered by 
                        <a href="https://zeonytechnologies.com" target="_blank" rel="noopener noreferrer" class="inline-block hover:opacity-100 transition-all duration-300 hover:scale-105">
                            <img src="static\img\zeony logo.png" alt="Zeony Technologies" class="h-12 w-22 py-2 object-contain"/>
                        </a><p class="text-xs opacity-80">A Student driven Software!</p>
    </p>
  </footer>
  <script>
    const SUPABASE_URL = "https://cbhodgwaazmjszkujrti.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNiaG9kZ3dhYXptanN6a3VqcnRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NzY4NzEsImV4cCI6MjA3MTI1Mjg3MX0.sBRdfiWJJmZtLWsHCcNyxm1VcwkGwZWsIeeMlS49XTU";
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    // Word counter functionality
    const suggestionsField = document.getElementById('suggestions');
    const wordCountDisplay = document.getElementById('word-count');
    
    suggestionsField.addEventListener('input', function() {
      const text = this.value.trim();
      const words = text ? text.split(/\s+/).filter(word => word.length > 0) : [];
      const wordCount = words.length;
      
      wordCountDisplay.textContent = `${wordCount}/500 words`;
      
      if (wordCount > 500) {
        wordCountDisplay.classList.add('text-red-500');
        wordCountDisplay.classList.remove('text-gray-500');
      } else {
        wordCountDisplay.classList.add('text-gray-500');
        wordCountDisplay.classList.remove('text-red-500');
      }
    });

    document.getElementById('suggestion-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const suggestions = document.getElementById('suggestions').value.trim();
      const words = suggestions ? suggestions.split(/\s+/).filter(word => word.length > 0) : [];
      
      if (words.length > 500) {
        const errorMsg = document.getElementById('error-message');
        errorMsg.textContent = 'Please limit your suggestions to 500 words or less.';
        errorMsg.classList.remove('hidden');
        return;
      }
      
      const name = document.getElementById('name').value.trim() || null;
      const department = document.getElementById('department').value.trim() || null;
      
      const successMsg = document.getElementById('success-message');
      const errorMsg = document.getElementById('error-message');
      successMsg.classList.add('hidden');
      errorMsg.classList.add('hidden');
      
      const { error } = await supabaseClient
        .from('suggestion')
        .insert({
          "Name(optional)": name,
          "department(optional)": department,
          "suggestion": suggestions
        });
      
      if (error) {
        errorMsg.textContent = 'Error: ' + (error.message || 'Could not submit suggestion.');
        errorMsg.classList.remove('hidden');
      } else {
        successMsg.classList.remove('hidden');
        document.getElementById('suggestion-form').reset();
        wordCountDisplay.textContent = '0/500 words';
        wordCountDisplay.classList.add('text-gray-500');
        wordCountDisplay.classList.remove('text-red-500');
      }
    });
  </script>
</body>
</html>
