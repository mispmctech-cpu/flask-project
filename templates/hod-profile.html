<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HOD Profile</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-pmcBg min-h-screen">
  <header class="bg-purple-700 text-white">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="https://tse1.mm.bing.net/th/id/OIP.paY-ha-IpNQJrH2Lz_JZEgHaDG?w=2560&h=1070&rs=1&pid=ImgDetMain&o=7&rm=3" alt="PMC Logo" class="h-12 mr-4 rounded shadow bg-white p-1" />
        <nav class="hidden sm:flex gap-6 ml-6 text-sm font-medium">
          <a href="hod.html" class="opacity-90 hover:opacity-100">Back</a>
          <span class="underline decoration-2 underline-offset-4">HOD Profile</span>
        </nav>
      </div>
    </div>
  </header>
  <main class="max-w-6xl mx-auto px-4 py-8">
    <section class="bg-white rounded-xl card-shadow p-6 mb-8">
      <div class="flex flex-col md:flex-row items-start gap-8">
        <div class="flex-shrink-0 text-center w-full md:w-auto">
          <div class="relative inline-block">
            <img id="hodImage" class="w-40 h-40 object-cover shadow border-4 border-pmcPurple mx-auto" style="border-radius: 16px;" src="" alt="HOD Image">
          </div>
        </div>
        <div class="flex-1 w-full">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="text-sm font-medium text-gray-600">Employee ID</label>
              <div id="hodEmployeeID" class="mt-1 block w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 text-pmcPurple"></div>
            </div>
            <div>
              <label class="text-sm font-medium text-gray-600">Name</label>
              <div id="hodName" class="mt-1 block w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 text-lg font-bold text-pmcPurple"></div>
            </div>
            <div>
              <label class="text-sm font-medium text-gray-600">Department</label>
              <div id="hodDepartment" class="mt-1 block w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 text-pmcPurple"></div>
            </div>
            <div>
              <label class="text-sm font-medium text-gray-600">Email ID</label>
              <div id="hodEmail" class="mt-1 block w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 text-gray-600"></div>
            </div>
            <div>
              <label class="text-sm font-medium text-gray-600">Designation</label>
              <div id="hodDesignation" class="mt-1 block w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 text-pmcPurpleDark font-semibold"></div>
            </div>
            <div>
              <label class="text-sm font-medium text-gray-600">Username</label>
              <div id="hodUsername" class="mt-1 block w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 text-gray-600"></div>
            </div>
            <div>
              <label class="text-sm font-medium text-gray-600">Salary</label>
              <div id="hodSalary" class="mt-1 block w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 text-gray-600"></div>
            </div>
            <div>
              <label class="text-sm font-medium text-gray-600">Experience</label>
              <div id="hodExperience" class="mt-1 block w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 text-gray-600"></div>
            </div>
            <div class="md:col-span-2">
              <label class="text-sm font-medium text-gray-600">Qualification</label>
              <div id="hodQualification" class="mt-1 block w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2 text-gray-600"></div>
            </div>
          </div>
        </div>
      </div>
      <!-- SEM, SUBJECT, CLASS Table -->
      <div class="mt-8">
        <label class="text-sm font-medium text-gray-600">SEM, SUBJECT, CLASS</label>
        <div id="hodSemSubjectClassTable" class="mt-1"></div>
      </div>
      <!-- Details Table -->
      <div class="mt-8">
        <label class="text-sm font-medium text-gray-600">Details Table</label>
        <div id="hodDetailsTable" class="mt-1"></div>
      </div>
    </section>
    <section class="card-shadow rounded-xl overflow-hidden">
      <div class="bg-white p-4">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-50">
            <tr class="text-left text-gray-700">
              <th class="p-4 w-16">S.No</th>
              <th class="p-4">Role Name</th>
              <th class="p-4 w-60">Link</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y" id="hodForms"></tbody>
        </table>
      </div>
    </section>
  </main>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <script>
    // Get department from query param or localStorage
    function getQueryParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }
    const departmentParam = getQueryParam('department');
    const department = departmentParam || localStorage.getItem('department') || '';
    const supabaseClient = window.supabase.createClient(
      "https://cbhodgwaazmjszkujrti.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNiaG9kZ3dhYXptanN6a3VqcnRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NzY4NzEsImV4cCI6MjA3MTI1Mjg3MX0.sBRdfiWJJmZtLWsHCcNyxm1VcwkGwZWsIeeMlS49XTU"
    );
    async function loadHodProfile() {
      if (!department) {
        document.body.innerHTML = '<div class="text-center mt-20 text-red-500">No department specified.</div>';
        return;
      }
      const { data, error } = await supabaseClient
        .from('HOD')
        .select('*')
        .eq('department', department)
        .single();
      if (error || !data) {
        document.body.innerHTML = `<div class="text-center mt-20 text-red-500">HOD not found for department: <b>${department}</b></div>`;
        return;
      }
      document.getElementById('hodImage').src = data['Upload Image'] || 'https://img.freepik.com/free-vector/blue-circle-with-white-user_78370-4707.jpg?semt=ais_hybrid&w=740&q=80';
      document.getElementById('hodEmployeeID').textContent = data['EmployeeID'] || '';
      document.getElementById('hodName').textContent = data['Name'] || '';
      document.getElementById('hodDesignation').textContent = data['Designation'] || '';
      document.getElementById('hodDepartment').textContent = data['department'] || '';
      document.getElementById('hodEmail').textContent = data['email'] || '';
      document.getElementById('hodUsername').textContent = data['Username'] || '';
      document.getElementById('hodSalary').textContent = data['Salary'] || '';
      document.getElementById('hodExperience').textContent = data['Experience'] || '';
      document.getElementById('hodQualification').textContent = data['Qualification'] || '';
      // SEM, SUBJECT, CLASS Table
      let semSubjectClassArr = [];
      try { semSubjectClassArr = data['SEM_SUBJECT_CLASS'] ? JSON.parse(data['SEM_SUBJECT_CLASS']) : []; } catch(e) {}
      let semTableHtml = '';
      if (Array.isArray(semSubjectClassArr) && semSubjectClassArr.length > 0) {
        semTableHtml = `<div class="overflow-x-auto"><table class="min-w-full text-sm border rounded-lg overflow-hidden shadow-sm bg-white">
          <thead class='bg-purple-700 text-white'>
            <tr><th class="px-4 py-2">SEM</th><th class="px-4 py-2">SUBJECT</th><th class="px-4 py-2">CLASS</th></tr>
          </thead>
          <tbody>` +
          semSubjectClassArr.map((row, idx) => `<tr class="${idx%2===0?'bg-gray-50':'bg-white'}"><td class="px-2 py-2">${row.sem||''}</td><td class="px-2 py-2">${row.subject||''}</td><td class="px-2 py-2">${row.class||''}</td></tr>`).join('') +
          `</tbody></table></div>`;
      } else {
        semTableHtml = '<div class="text-gray-400">No data</div>';
      }
      document.getElementById('hodSemSubjectClassTable').innerHTML = semTableHtml;
      // Details Table
      let detailsTableArr = [];
      try { detailsTableArr = data['DETAILS_TABLE'] ? JSON.parse(data['DETAILS_TABLE']) : []; } catch(e) {}
      let detailsTableHtml = '';
      if (Array.isArray(detailsTableArr) && detailsTableArr.length > 0) {
        detailsTableHtml = `<div class="overflow-x-auto"><table class="min-w-full text-sm border rounded-lg overflow-hidden shadow-sm bg-white">
          <thead class='bg-purple-700 text-white'>
            <tr><th class="px-4 py-2">S. NO</th><th class="px-4 py-2">PARTICULAR</th><th class="px-4 py-2">TARGET</th><th class="px-4 py-2">TAT</th><th class="px-4 py-2">Compliance</th></tr>
          </thead>
          <tbody>` +
          detailsTableArr.map((row, idx) => `<tr class="${idx%2===0?'bg-gray-50':'bg-white'}"><td class="px-2 py-2">${idx+1}</td><td class="px-2 py-2">${row.particular||''}</td><td class="px-2 py-2">${row.target||''}</td><td class="px-2 py-2">${row.tat||''}</td><td class="px-2 py-2">${row.compliance||''}</td></tr>`).join('') +
          `</tbody></table></div>`;
      } else {
        detailsTableHtml = '<div class="text-gray-400">No data</div>';
      }
      document.getElementById('hodDetailsTable').innerHTML = detailsTableHtml;
      // Forms assigned: show only 'yes' as table rows with real names and links
      const formNames = [
        'Students Performance in Training & Placement Member',
        'Class Advisor',
        'Faculty Information & Contribution Member',
        'Course Outcome & Program Outcome Member (Exam Cell)',
        'Continuous Improvement Member (Program Member)',
        'Teaching & Learning Process Member (IQAC)',
        'Student Support System Member (Discipline & Extra Curricular)',
        'Facilities & Technical Support Member (Lab Member)'
      ];
      const formLinks = [
        'faculty-form1.html',
        'faculty-form2.html',
        'faculty-form3.html',
        'faculty-form4.html',
        'faculty-form5.html',
        'faculty-form6.html',
        'faculty-form7.html',
        'faculty-form8.html'
      ];
      let formsHtml = '';
      let count = 1;
      for (let i = 1; i <= 8; i++) {
        if (data[`form${i}`] && data[`form${i}`].toLowerCase() === 'yes') {
          formsHtml += `<tr><td class="p-4 align-top">${count}</td><td class="p-4 align-top">${formNames[i-1]}</td><td class="p-4 align-top"><a href="${formLinks[i-1]}" class="inline-flex items-center gap-2 rounded-full bg-purple-700 text-white px-4 py-2 text-xs font-medium hover:bg-purple-700Dark transition">Open Form</a></td></tr>`;
          count++;
        }
      }
      document.getElementById('hodForms').innerHTML = formsHtml || '<tr><td colspan="3" class="text-gray-400 text-center p-4">No roles assigned.</td></tr>';
    }
    loadHodProfile();
  </script>  <!-- Footer -->
  <footer class="text-center py-4 mt-8">
    <p class="text-gray-400 text-sm"> © All Rights Reserved <a href="https://pmctech.org" target="_blank" class="text-gray-400 hover:text-gray-600 underline">PMC TECH</a>, IV CSE 2022-2026.<br/>Developed by <a href="https://zeonytechnologies.netlify.app" target="_blank" class="text-gray-400 hover:text-gray-600 underline">Zeony Technologies</a>
    </p>
  </footer>

</body>
</html>
